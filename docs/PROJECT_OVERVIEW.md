# æ™ºå­¦ OS (Home-Learning-OS) é¡¹ç›®æ¶æ„ä¸åŠŸèƒ½æè¿°

**ç”Ÿæˆæ—¶é—´**: 2026-01-20
**é¡¹ç›®ç‰ˆæœ¬**: v1.0.0
**æ–‡æ¡£ç”¨é€”**: ä¸ºåŠŸèƒ½ä¼˜åŒ–å’ŒUIè°ƒè¯•æä¾›å…¨é¢çš„æŠ€æœ¯å‚è€ƒ

---

## ç›®å½•

- [1. é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
- [2. æŠ€æœ¯æ¶æ„](#2-æŠ€æœ¯æ¶æ„)
- [3. åŠŸèƒ½æ¨¡å—](#3-åŠŸèƒ½æ¨¡å—)
- [4. UIè®¾è®¡ç³»ç»Ÿ](#4-uiè®¾è®¡ç³»ç»Ÿ)
- [5. æ•°æ®æ¨¡å‹](#5-æ•°æ®æ¨¡å‹)
- [6. APIè®¾è®¡](#6-apiè®¾è®¡)
- [7. æ ¸å¿ƒä¸šåŠ¡æµç¨‹](#7-æ ¸å¿ƒä¸šåŠ¡æµç¨‹)
- [8. éƒ¨ç½²æ¶æ„](#8-éƒ¨ç½²æ¶æ„)
- [9. å·²çŸ¥é™åˆ¶ä¸ä¼˜åŒ–æ–¹å‘](#9-å·²çŸ¥é™åˆ¶ä¸ä¼˜åŒ–æ–¹å‘)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®å®šä½

æ™ºå­¦ OS æ˜¯ä¸€ä¸ª**å®¶åº­å¤šç”¨æˆ·å­¦ä¹ ç®¡ç†ç³»ç»Ÿ**ï¼Œåˆ©ç”¨ Google Gemini 3 çš„å¤šæ¨¡æ€AIèƒ½åŠ›ï¼Œå°†çº¸è´¨å­¦ä¹ ææ–™ï¼ˆæ•™æã€æ‰‹å†™ç¬”è®°ã€è€ƒå·ï¼‰æ•°å­—åŒ–ä¸ºç»“æ„åŒ–çŸ¥è¯†åº“ã€‚

**æ ¸å¿ƒä»·å€¼ä¸»å¼ **:
- ğŸ¯ æ™ºèƒ½å›¾åƒè¯†åˆ«ï¼š4å±‚OCRè§£æ„åè®®ï¼Œç²¾å‡†æå–é¢˜ç›®ã€ç­”æ¡ˆã€æ‰¹æ³¨
- ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ å¤šç”¨æˆ·éš”ç¦»ï¼šæ”¯æŒå®¶åº­å¤šå­¦ç”Ÿç‹¬ç«‹æ•°æ®ç©ºé—´ + å…±äº«èµ„æº
- ğŸ§  AIé©±åŠ¨ï¼šä¸ªæ€§åŒ–è¯¾ä»¶ç”Ÿæˆã€æ™ºèƒ½è¯•å·å‡ºé¢˜ã€å®æ—¶è¯­éŸ³è¾…å¯¼
- ğŸ“š RAGå¢å¼ºï¼šAnythingLLMå‘é‡å­˜å‚¨ï¼Œä¸Šä¸‹æ–‡æ£€ç´¢å¢å¼ºç”Ÿæˆ
- ğŸ“± å…¨å¹³å°å“åº”å¼ï¼šæ¡Œé¢ç«¯ã€å¹³æ¿ã€æ‰‹æœºç»Ÿä¸€ä½“éªŒ

### 1.2 ç›®æ ‡ç”¨æˆ·

- **ä¸»è¦ç”¨æˆ·**: ä¸­å°å­¦ç”Ÿå®¶åº­ï¼ˆK12é˜¶æ®µï¼‰
- **æ¬¡è¦ç”¨æˆ·**: å®¶é•¿ï¼ˆç›‘ç£å­¦ä¹ è¿›åº¦ï¼‰
- **ä½¿ç”¨åœºæ™¯**:
  - é”™é¢˜æ‹ç…§å½’æ¡£
  - æ•™ææ•°å­—åŒ–ç®¡ç†
  - AIç”Ÿæˆä¸ªæ€§åŒ–å­¦ä¹ å†…å®¹
  - è€ƒå‰é’ˆå¯¹æ€§ç»ƒä¹ 

### 1.3 ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æµè§ˆå™¨ (Browser)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Vite + React 18 + TypeScript                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚Dashboardâ”‚ Library â”‚ Capture â”‚StudyRoomâ”‚ Tutor  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚    IndexedDB (bookStorage.ts)                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    - EBook[]                                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    - ScannedItem[] (å¯é€‰æŒä¹…åŒ–)                   â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ HTTPS/WS
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Nginx (Reverse Proxy)                       â”‚
â”‚           :80/:443 â†’ åç«¯ :3000, AnythingLLM :3001         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Node.js Backend â”‚                  â”‚  AnythingLLM RAG     â”‚
â”‚  Express.js      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  å‘é‡æ•°æ®åº“           â”‚
â”‚  :3000           â”‚  Index API       â”‚  :3001               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Google Gemini API                      â”‚
â”‚  - gemini-3-flash-preview (å›¾åƒåˆ†æ/è¯¾ä»¶)        â”‚
â”‚  - gemini-3-pro-preview (è¯•å·ç”Ÿæˆ/æ·±åº¦æ¨ç†)      â”‚
â”‚  - gemini-2.5-flash-preview-exp (å®æ—¶è¯­éŸ³)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. æŠ€æœ¯æ¶æ„

### 2.1 å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **React** | 18.2.0 | UIæ¡†æ¶ï¼Œå‡½æ•°å¼ç»„ä»¶ + Hooks |
| **TypeScript** | 5.6.3 | ç±»å‹å®‰å…¨ï¼ŒES2020ç›®æ ‡ |
| **Vite** | 5.0.8 | æ„å»ºå·¥å…·ï¼Œå¼€å‘æœåŠ¡å™¨ (HMR) |
| **Tailwind CSS** | 3.4.1 | åŸå­åŒ–æ ·å¼ç³»ç»Ÿ |
| **Framer Motion** | 12.27.1 | å£°æ˜å¼åŠ¨ç”»åº“ |
| **Lucide React** | 0.263.1 | å›¾æ ‡åº“ (2000+ SVGå›¾æ ‡) |
| **React Markdown** | 8.0.7 | Markdownæ¸²æŸ“ (è¯¾ä»¶/è¯•å·) |
| **Canvas Confetti** | 1.9.4 | åº†ç¥åŠ¨ç”»æ•ˆæœ |
| **IndexedDB** | åŸç”ŸAPI | æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ (bookStorage.ts) |

### 2.2 åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Node.js** | 20.x | è¿è¡Œæ—¶ç¯å¢ƒ |
| **Express.js** | 4.21.2 | RESTful APIæ¡†æ¶ |
| **TypeScript** | 5.7.2 | åç«¯ç±»å‹å®‰å…¨ |
| **@google/genai** | 1.37.0 | Gemini APIå®¢æˆ·ç«¯SDK |
| **Multer** | 1.4.5-lts.1 | æ–‡ä»¶ä¸Šä¼ ä¸­é—´ä»¶ (100MBé™åˆ¶) |
| **pdf-parse** | 1.1.1 | PDFæ–‡æœ¬æå– |
| **epub2** | 3.0.2 | EPUBç”µå­ä¹¦è§£æ |
| **cors** | 2.8.5 | è·¨åŸŸèµ„æºå…±äº« |

### 2.3 å¼€å‘ä¸éƒ¨ç½²å·¥å…·

| å·¥å…· | ç”¨é€” |
|------|------|
| **Docker Compose** | å®¹å™¨ç¼–æ’ (nginx + backend + anythingllm) |
| **Systemd** | æœåŠ¡ç®¡ç† (hl-backend.service) |
| **PM2** (å¯é€‰) | Nodeè¿›ç¨‹ç®¡ç† |
| **Git** | ç‰ˆæœ¬æ§åˆ¶ |
| **npm** | åŒ…ç®¡ç†å™¨ |

### 2.4 å¤–éƒ¨æœåŠ¡é›†æˆ

| æœåŠ¡ | ç”¨é€” | é…ç½® |
|------|------|------|
| **Google Gemini API** | AIæ¨ç† | GEMINI_API_KEY |
| **AnythingLLM** | RAGå‘é‡æ•°æ®åº“ | ANYTHINGLLM_ENDPOINT, API_KEY |

---

## 3. åŠŸèƒ½æ¨¡å—

### 3.1 Dashboard (æ¦‚è§ˆé¢æ¿)

**æ–‡ä»¶**: `components/Dashboard.tsx`

**åŠŸèƒ½æè¿°**:
- ä¸ªæ€§åŒ–æ¬¢è¿è¯­ï¼ˆæ ¹æ®æ—¶æ®µï¼šæ—©å®‰/ä¸‹åˆå¥½/æ™šä¸Šå¥½ï¼‰
- 4ä¸ªç»Ÿè®¡å¡ç‰‡ï¼š
  - æ€»æ”¶å½•æ•° (æ‰€æœ‰ScannedItem)
  - å¾…å¤ä¹ æ•° (WRONG_PROBLEMç±»å‹)
  - æœ¬å‘¨å­¦ä¹  (é™æ€æ•°æ®ï¼Œå¾…æ¥å…¥çœŸå®ç»Ÿè®¡)
  - æŒæ¡ç‡ (NOTEç±»å‹å æ¯”)
- æœ€è¿‘å­¦ä¹ æ—¶é—´è½´ (æœ€è¿‘5æ¡è®°å½•)
- å¿«æ·å…¥å£ç½‘æ ¼ (4ä¸ªå¸¸ç”¨åŠŸèƒ½)

**æ•°æ®æµå‘**:
```
App.tsx
  â†’ filteredItems (useMemoè¿‡æ»¤å½“å‰ç”¨æˆ·æ•°æ®)
  â†’ Dashboard props
  â†’ å®æ—¶ç»Ÿè®¡è®¡ç®—
```

**äº¤äº’è¡Œä¸º**:
- ç»Ÿè®¡å¡ç‰‡æ˜¾ç¤ºè¶‹åŠ¿ç®­å¤´ (TrendingUpå›¾æ ‡ + ç™¾åˆ†æ¯”)
- å¿«æ·å…¥å£æŒ‰é’® hover æ—¶å›¾æ ‡æ—‹è½¬6åº¦ + èƒŒæ™¯è‰²è¿‡æ¸¡
- ç‚¹å‡»å¿«æ·å…¥å£åˆ‡æ¢åˆ°å¯¹åº”Tab

**æ ·å¼ç‰¹ç‚¹**:
- æ¸å˜è‰²æ¬¢è¿åŒº (`from-sky-400 to-mint-400`)
- ç»Ÿè®¡å¡ç‰‡ä½¿ç”¨å­¦ç§‘é¢œè‰²ç³»ç»Ÿ (20%é€æ˜åº¦èƒŒæ™¯)
- æ—¶é—´è½´å‚ç›´çº¿ (0.5å®½åº¦ç°è‰²åˆ†éš”ç¬¦)

---

### 3.2 LibraryHub (å›¾ä¹¦é¦†)

**æ–‡ä»¶**: `components/LibraryHub.tsx`, `components/BookCard.tsx`, `components/BookUploader.tsx`

**åŠŸèƒ½æè¿°**:
- æ•™æä¸Šä¼  (PDF/EPUB/TXTï¼Œæœ€å¤§100MB)
- å…ƒæ•°æ®AIè‡ªåŠ¨æå– (æ ‡é¢˜ã€å­¦ç§‘ã€å¹´çº§ã€æ ‡ç­¾ã€ç›®å½•)
- å›¾ä¹¦å¡ç‰‡å±•ç¤º (ç½‘æ ¼å¸ƒå±€)
- ç« èŠ‚ç›®å½•æ ‘ç»“æ„å±•ç¤º
- å›¾ä¹¦ç¼–è¾‘/åˆ é™¤
- AnythingLLMç´¢å¼•é›†æˆ (å¯é€‰)

**ä¸Šä¼ æµç¨‹**:
```
1. ç”¨æˆ·é€‰æ‹©æ–‡ä»¶ (BookUploader)
2. POST /api/upload-book (multipart/form-data)
3. åç«¯è§£ææ–‡ä»¶å†…å®¹ (pdfParser/epubParser)
4. Gemini AI åˆ†æå…ƒæ•°æ® (bookMetadataAnalyzer)
5. è¿”å›åŒ…å«å…ƒæ•°æ®çš„EBookå¯¹è±¡
6. å‰ç«¯æ˜¾ç¤ºå…ƒæ•°æ®ç¼–è¾‘å™¨ (BookMetadataEditor)
7. ç”¨æˆ·ç¡®è®¤/ä¿®æ”¹åä¿å­˜åˆ°IndexedDB
8. å¯é€‰ï¼šç´¢å¼•åˆ°AnythingLLMå‘é‡åº“
```

**å…³é”®ç»„ä»¶**:

**BookUploader**:
- æ‹–æ‹½ä¸Šä¼  + ç‚¹å‡»é€‰æ‹©
- æ–‡ä»¶æ ¼å¼éªŒè¯ (accept="application/pdf,application/epub+zip,text/plain")
- è¿›åº¦æ¡æ˜¾ç¤º (ä¸Šä¼ ä¸­/åˆ†æä¸­)
- é”™è¯¯å¤„ç† (æ–‡ä»¶è¿‡å¤§ã€æ ¼å¼ä¸æ”¯æŒ)

**BookCard**:
- æ‚¬æµ®å¡ç‰‡æ•ˆæœ (hoveré˜´å½±åŠ æ·±)
- å­¦ç§‘æ ‡ç­¾å¾½ç«  (Badgeç»„ä»¶)
- æ–‡ä»¶æ ¼å¼å›¾æ ‡ (PDF/EPUB/TXT)
- ä¸Šä¼ æ—¶é—´æ˜¾ç¤º
- å¿«æ·æ“ä½œæŒ‰é’® (ç¼–è¾‘/åˆ é™¤/æŸ¥çœ‹ç›®å½•)

**BookMetadataEditor**:
- è¡¨å•å­—æ®µï¼šæ ‡é¢˜ã€ä½œè€…ã€å­¦ç§‘ã€å¹´çº§ã€ç±»åˆ«ã€æ ‡ç­¾
- ç« èŠ‚ç›®å½•æ ‘ç¼–è¾‘ (å¯æ·»åŠ /åˆ é™¤/é‡æ’)
- å®æ—¶é¢„è§ˆ

---

### 3.3 CaptureModule (æ‹é¢˜å½•å…¥)

**æ–‡ä»¶**: `components/CaptureModule.tsx`

**åŠŸèƒ½æè¿°**:
- ç›¸æœºæ‹æ‘„ (ç§»åŠ¨ç«¯)
- å›¾ç‰‡ä¸Šä¼  (æ¡Œé¢ç«¯)
- AIå›¾åƒåˆ†æ (4å±‚OCRè§£æ„)
- ç»“æœå®¡æ ¸ä¸ä¿®æ­£
- æ‰¹é‡å½’æ¡£

**4å±‚OCRè§£æ„åè®®**:
```markdown
ç¬¬1å±‚ï¼šå°åˆ·åŸé¢˜ï¼ˆåŸé¢˜æ–‡æœ¬ï¼‰
ç¬¬2å±‚ï¼šçº¢ç¬”æ‰¹æ”¹ï¼ˆæ•™å¸ˆæ‰¹æ³¨ï¼‰
ç¬¬3å±‚ï¼šå­¦ç”Ÿè¡ŒåŠ¨ï¼ˆè®¢æ­£ç­”æ¡ˆï¼‰
ç¬¬4å±‚ï¼šæ”¶å°¾é—­ç¯ï¼ˆæ˜¯å¦çœŸæ­£æŒæ¡ï¼‰
```

**äº¤äº’æµç¨‹**:
```
1. ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ â†’ handleFileChange()
   - å›¾ç‰‡é¢„è§ˆ
   - base64ç¼–ç 

2. ç‚¹å‡»"åˆ†æ"æŒ‰é’® â†’ handleProcess()
   - æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
   - fetch('/api/analyze-image', { base64Image })

3. AIåˆ†æå®Œæˆ â†’ æ˜¾ç¤ºå®¡æ ¸ç•Œé¢
   - Markdowné¢„è§ˆ (ReactMarkdown)
   - ProblemUnitåˆ—è¡¨ç¼–è¾‘å™¨
   - æ¯ä¸ªé¢˜ç›®å¯ä¿®æ”¹çŠ¶æ€ (CORRECT/WRONG/CORRECTED)

4. ç”¨æˆ·ç¡®è®¤ â†’ handleSaveAndArchive()
   - è§¦å‘ onScanComplete(ScannedItem)
   - App.tsx æ›´æ–° scannedItems[]
   - æ˜¾ç¤ºæˆåŠŸåŠ¨ç”» (confetti)
```

**çŠ¶æ€ç®¡ç†**:
```typescript
const [imageBase64, setImageBase64] = useState<string>('');
const [status, setStatus] = useState<ProcessingStatus>('IDLE');
const [rawMarkdown, setRawMarkdown] = useState<string>('');
const [meta, setMeta] = useState<StructuredMetaData | null>(null);
const [reviewItem, setReviewItem] = useState<ScannedItem | null>(null);
```

---

### 3.4 StudyRoom (AIå­¦ä¹ å›­åœ°)

**æ–‡ä»¶**: `components/StudyRoom.tsx`, `components/ChapterSelector.tsx`, `components/CoursewareGenerator.tsx`, `components/QuizGenerator.tsx`

**åŠŸèƒ½æè¿°**:
ä¸‰æ­¥èµ°å­¦ä¹ æµç¨‹ï¼š
1. **é€‰æ‹©ç« èŠ‚**: ä»å›¾ä¹¦é¦†é€‰æ‹©æ•™æå’Œå…·ä½“ç« èŠ‚
2. **ç”Ÿæˆè¯¾ä»¶**: AIç”Ÿæˆä¸ªæ€§åŒ–Markdownè¯¾ä»¶ (4ç§æ•™å­¦é£æ ¼)
3. **é…å¥—æµ‹éªŒ**: åŸºäºè¯¾ä»¶å†…å®¹ç”Ÿæˆæµ‹éªŒé¢˜

**æ­¥éª¤1: ChapterSelector**:
- å±•ç¤ºç”¨æˆ·å›¾ä¹¦é¦†çš„æ‰€æœ‰æ•™æ
- æ ‘å½¢ç›®å½•ç»“æ„é€‰æ‹©å™¨ (level 1/2/3 å±‚çº§)
- ç« èŠ‚è·¯å¾„é¢åŒ…å±‘å¯¼èˆª

**æ­¥éª¤2: CoursewareGenerator**:

**æ•™å­¦é£æ ¼é€‰é¡¹**:
| é£æ ¼ | Icon | æè¿° |
|------|------|------|
| ä¸¥è°¨è®²è§£ (rigorous) | ğŸ“ | ç³»ç»Ÿå®Œæ•´ï¼Œé€»è¾‘ä¸¥å¯†ï¼Œé€‚åˆç†ç§‘ |
| æ•…äº‹åŒ– (storytelling) | ğŸ“š | ç”ŸåŠ¨å½¢è±¡ï¼Œè¶£å‘³æ€§å¼ºï¼Œæ˜“äºç†è§£ |
| å®è·µå¯¼å‘ (practice) | âœï¸ | å¤§é‡ä¾‹é¢˜ï¼Œè¾¹å­¦è¾¹ç»ƒ |
| æ¢ç©¶å¼ (exploration) | ğŸ” | å¯å‘æ€è€ƒï¼ŒåŸ¹å…»æ¢ç´¢ç²¾ç¥ |

**APIè¯·æ±‚**:
```typescript
POST /api/generate-courseware
Body: {
  bookTitle: string,
  chapter: string,
  studentName: string,
  subject: string,
  teachingStyle: TeachingStyle,
  wrongProblems: ScannedItem[] (å‰10æ¡)
}

Response: {
  success: boolean,
  data: string (Markdownæ ¼å¼è¯¾ä»¶)
}
```

**ç‰¹æ€§**:
- æ™ºèƒ½æç¤ºï¼šè‹¥æ£€æµ‹åˆ°å†å²é”™é¢˜ï¼Œä¼˜å…ˆè®²è§£ç›¸å…³çŸ¥è¯†ç‚¹
- è¯¾ä»¶ä¸‹è½½ï¼šBlobå¯¼å‡ºä¸º `.md` æ–‡ä»¶
- é‡æ–°ç”Ÿæˆï¼šæ¸…ç©ºå½“å‰è¯¾ä»¶é‡æ–°é€‰æ‹©é£æ ¼

**æ­¥éª¤3: QuizGenerator**:

**å‡ºé¢˜è§„åˆ™**:
- æ¯ä¸ªæ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š2é“åŸºç¡€é¢˜ + 1é“æé«˜é¢˜
- éš¾åº¦åˆ†é…ï¼š70%åŸºç¡€é¢˜ + 30%æé«˜é¢˜
- è‹¥æœ‰å†å²é”™é¢˜ï¼šé’ˆå¯¹è–„å¼±ç¯èŠ‚å‡ºå˜å¼é¢˜

**APIè¯·æ±‚**:
```typescript
POST /api/generate-assessment
Body: {
  bookTitle: string,
  subject: string,
  chapter: string,
  studentName: string,
  wrongProblems: ScannedItem[] (å‰10æ¡),
  coursewareContent: string (å‰1000å­—ç¬¦)
}

Response: {
  success: boolean,
  data: string (Markdownæ ¼å¼æµ‹éªŒå·)
}
```

**é”™è¯¯å¤„ç†**:
- 404: APIæ¥å£æœªæ‰¾åˆ° â†’ æç¤ºæ£€æŸ¥åç«¯æœåŠ¡
- 429: APIé…é¢è¶…é™ â†’ æç¤ºå‡çº§å¥—é¤æˆ–ç¨åé‡è¯•
- 503: ç½‘ç»œè¿æ¥å¤±è´¥ â†’ æç¤ºæ£€æŸ¥é˜²ç«å¢™
- 401/403: APIè®¤è¯å¤±è´¥ â†’ æç¤ºæ£€æŸ¥API Key

---

### 3.5 KnowledgeHub (æ¡£æ¡ˆåº“)

**æ–‡ä»¶**: `components/KnowledgeHub.tsx`

**åŠŸèƒ½æè¿°**:
- æ‰€æœ‰æ‰«æé¡¹çš„é›†ä¸­å±•ç¤º
- å¤šç»´åº¦è¿‡æ»¤ï¼š
  - æ–‡æ¡£ç±»å‹ (é”™é¢˜/ç¬”è®°/è¯¾ä»¶/è€ƒå·ç­‰)
  - å­¦ç§‘ç­›é€‰
  - æ—¶é—´æ’åº
- å•é¡¹è¯¦æƒ…æŸ¥çœ‹
- ç¼–è¾‘å…ƒæ•°æ®
- åˆ é™¤æ“ä½œ
- Markdownå¯¼å‡º

**æ•°æ®å±•ç¤º**:
- å¡ç‰‡ç½‘æ ¼å¸ƒå±€ (ç€‘å¸ƒæµæ•ˆæœ)
- ç¼©ç•¥å›¾ (base64å›¾ç‰‡é¢„è§ˆ)
- é¢˜ç›®æ•°é‡å¾½ç« 
- å­¦ç§‘æ ‡ç­¾
- çŸ¥è¯†çŠ¶æ€æ ‡ç­¾ (å·²æŒæ¡/æœªæŒæ¡/éœ€åŠ å¼º)

**æœç´¢ä¸è¿‡æ»¤**:
```typescript
const filtered = items
  .filter(item =>
    (selectedType === 'all' || item.meta.type === selectedType) &&
    (selectedSubject === 'all' || item.meta.subject === selectedSubject)
  )
  .sort((a, b) => sortOrder === 'desc'
    ? b.timestamp - a.timestamp
    : a.timestamp - b.timestamp
  );
```

---

### 3.6 ExamCenter (è€ƒè¯•ä¸­å¿ƒ)

**æ–‡ä»¶**: `components/ExamCenter.tsx`

**åŠŸèƒ½æè¿°**:
- æ™ºèƒ½ç»„å· (åŸºäºé”™é¢˜æœ¬ + RAGæ£€ç´¢)
- éš¾åº¦é€‰æ‹© (ç®€å•/ä¸­ç­‰/å›°éš¾)
- é¢˜å‹åˆ†é… (é€‰æ‹©é¢˜/å¡«ç©ºé¢˜/è§£ç­”é¢˜)
- æ—¶é—´é™åˆ¶è®¾å®š
- æ¨¡æ‹Ÿè€ƒè¯•æ¨¡å¼
- ç­”æ¡ˆæäº¤ä¸æ‰¹æ”¹

**ç»„å·é€»è¾‘**:
```
1. ç”¨æˆ·é€‰æ‹©å­¦ç§‘ã€ç« èŠ‚èŒƒå›´ã€éš¾åº¦çº§åˆ«
2. ç³»ç»Ÿä» wrongProblems[] æå–è–„å¼±çŸ¥è¯†ç‚¹
3. AnythingLLM RAG æ£€ç´¢ç›¸ä¼¼é¢˜ç›®
4. Geminiç”Ÿæˆé¢˜ç›®å˜å¼
5. ç»„è£…æˆå®Œæ•´è¯•å· (Markdownæ ¼å¼)
```

---

### 3.7 LiveTutor (AIå®æ—¶è¾…å¯¼)

**æ–‡ä»¶**: `components/LiveTutor.tsx`

**åŠŸèƒ½æè¿°**:
- å®æ—¶è¯­éŸ³å¯¹è¯ (Gemini 2.5 Flash Live API)
- å±å¹•å…±äº«æ¨¡å¼ (å®æ—¶åˆ†æé¢˜ç›®)
- æ–‡å­—+è¯­éŸ³åŒæ¨¡å¼
- å¯¹è¯å†å²è®°å½•
- çŸ¥è¯†ç‚¹è¿½è¸ª

**æŠ€æœ¯å®ç°**:
- WebSocketè¿æ¥ (gemini-2.5-flash-preview-exp)
- Web Audio API (éº¦å…‹é£è¾“å…¥)
- MediaRecorder (éŸ³é¢‘å½•åˆ¶)
- Canvasç»˜å›¾ (å®æ—¶æ³¢å½¢æ˜¾ç¤º)

---

## 4. UIè®¾è®¡ç³»ç»Ÿ

### 4.1 è‰²å½©ç³»ç»Ÿ

**ä¸»è‰²è°ƒ** (`tailwind.config.js`):

| é¢œè‰² | è‰²å€¼ | ç”¨é€” |
|------|------|------|
| sky-500 | #4A90E2 | ä¸»å“ç‰Œè‰²ï¼ŒæŒ‰é’®ã€é“¾æ¥ |
| mint-400 | #5FD4A0 | æˆåŠŸçŠ¶æ€ï¼Œæ¬¡çº§æ“ä½œ |
| sunset-400 | #FFB84D | è­¦å‘Šæç¤ºï¼Œå¾…åŠäº‹é¡¹ |

**å­¦ç§‘è‰²å½©**:
| å­¦ç§‘ | ä¸»è‰² | æµ…è‰²èƒŒæ™¯ |
|------|------|----------|
| æ•°å­¦ | #3B82F6 (math) | #DBEAFE (math-light) |
| è¯­æ–‡ | #FB7185 (chinese) | #FECDD3 |
| è‹±è¯­ | #A78BFA (english) | #E9D5FF |
| ç§‘å­¦ | #10B981 (science) | #D1FAE5 |

**èƒŒæ™¯è‰²**:
- paper: `#F8F9FA` (çº¸å¼ çº¹ç†èƒŒæ™¯)
- æ¸å˜èƒŒæ™¯: `from-gray-50 to-paper`

### 4.2 å­—ä½“ç³»ç»Ÿ

```css
font-family: "PingFang SC", "Microsoft YaHei", system-ui, -apple-system, sans-serif
```

**å­—å·é˜¶æ¢¯**:
- text-xs: 12px
- text-sm: 14px
- text-base: 16px
- text-lg: 18px
- text-xl: 20px
- text-2xl: 24px
- text-3xl: 30px

### 4.3 é˜´å½±ç³»ç»Ÿ

```css
shadow-card: 0 4px 16px rgba(0, 0, 0, 0.08)
shadow-card-hover: 0 8px 24px rgba(0, 0, 0, 0.12)
shadow-modal: 0 12px 32px rgba(0, 0, 0, 0.15)
```

### 4.4 é—´è·ç³»ç»Ÿ

- å¸ƒå±€é—´è·: `space-y-6` (24px)
- å¡ç‰‡å†…è¾¹è·: `p-6` (24px)
- æŒ‰é’®å†…è¾¹è·: `px-6 py-3`
- ç½‘æ ¼é—´è·: `gap-4` (16px)

### 4.5 å“åº”å¼æ–­ç‚¹

| æ–­ç‚¹ | å®½åº¦ | è®¾å¤‡ |
|------|------|------|
| `sm` | 640px | æ‰‹æœºæ¨ªå± |
| `md` | 768px | å¹³æ¿ |
| `lg` | 1024px | æ¡Œé¢ |
| `xl` | 1280px | å¤§å±æ¡Œé¢ |

**å¸ƒå±€ç­–ç•¥**:
- **ç§»åŠ¨ç«¯** (<768px): åº•éƒ¨å¯¼èˆªæ  + å•åˆ—å¸ƒå±€
- **æ¡Œé¢ç«¯** (â‰¥768px): ä¾§è¾¹æ å¯¼èˆª + å¤šåˆ—ç½‘æ ¼

### 4.6 ç»„ä»¶åº“ (`components/ui/`)

**Button ç»„ä»¶**:
```typescript
variant: 'primary' | 'secondary' | 'outline' | 'success' | 'danger'
size: 'sm' | 'md' | 'lg'
icon?: LucideIcon
disabled?: boolean
loading?: boolean
```

**Card ç»„ä»¶**:
```typescript
hover?: boolean  // hoveræ—¶é˜´å½±åŠ æ·±
className?: string
children: ReactNode
```

**Badge ç»„ä»¶**:
```typescript
variant: 'default' | 'success' | 'warning' | 'error' | 'info'
size: 'sm' | 'md'
children: string
```

**LoadingSpinner**:
- 3ç§å°ºå¯¸ (sm/md/lg)
- æ¸å˜è‰²æ—‹è½¬åŠ¨ç”»

### 4.7 åŠ¨ç”»æ•ˆæœ

**Framer Motion åŠ¨ç”»**:
```typescript
// é¡µé¢åˆ‡æ¢
<motion.div
  initial={{ opacity: 0, y: 20 }}
  animate={{ opacity: 1, y: 0 }}
  exit={{ opacity: 0, y: -20 }}
  transition={{ duration: 0.3 }}
/>

// å¡ç‰‡æ‚¬æµ®
<motion.div
  whileHover={{ scale: 1.02, boxShadow: '0 8px 24px rgba(0,0,0,0.12)' }}
  transition={{ type: 'spring', stiffness: 300 }}
/>

// æŒ‰é’®ç‚¹å‡»
<motion.button
  whileTap={{ scale: 0.95 }}
/>
```

**Canvas Confetti (åº†ç¥åŠ¨ç”»)**:
```typescript
import confetti from 'canvas-confetti';

// é¢˜ç›®åˆ†æå®Œæˆæ—¶
confetti({
  particleCount: 100,
  spread: 70,
  origin: { y: 0.6 }
});
```

---

## 5. æ•°æ®æ¨¡å‹

### 5.0 æ•°æ®å­˜å‚¨æ¶æ„

æ™ºå­¦ OS é‡‡ç”¨**ä¸‰å±‚å­˜å‚¨æ¶æ„**ï¼Œé’ˆå¯¹ä¸åŒæ•°æ®ç±»å‹ä½¿ç”¨æœ€ä¼˜å­˜å‚¨æ–¹æ¡ˆï¼Œå…¼é¡¾æ€§èƒ½ã€å¯ç»´æŠ¤æ€§å’Œèµ„æºå ç”¨ï¼ˆé€‚é… 2C4G æœåŠ¡å™¨ï¼‰ã€‚

---

#### 5.0.1 ä¸‰å±‚å­˜å‚¨æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å±‚çº§1: AnythingLLM (å‘é‡æ•°æ®åº“ - çƒ­æ•°æ®/å¯æœç´¢)          â”‚
â”‚  â”œâ”€ LanceDB å‘é‡å­˜å‚¨ (åµŒå…¥å®¹å™¨å†…)                        â”‚
â”‚  â”œâ”€ Gemini text-embedding-004 å‘é‡åŒ–                    â”‚
â”‚  â”œâ”€ å­˜å‚¨: æ–‡æœ¬å†…å®¹ + å…ƒæ•°æ®(å«æ–‡ä»¶è·¯å¾„é“¾æ¥)              â”‚
â”‚  â””â”€ ç”¨é€”: RAGæ£€ç´¢ã€è¯­ä¹‰æœç´¢                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“ å…ƒæ•°æ®åŒ…å«æ–‡ä»¶è·¯å¾„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å±‚çº§2: Obsidianæ–‡ä»¶å¤¹ (ç»“æ„åŒ–å†…å®¹/æ°¸ä¹…å­˜å‚¨)              â”‚
â”‚  â”œâ”€ Wrong_Problems/    (é”™é¢˜æœ¬ Markdown)                â”‚
â”‚  â”œâ”€ No_Problems/       (è¯•å·&ä½œä¸š Markdown)             â”‚
â”‚  â””â”€ Courses/           (è¯¾ä»¶&æµ‹éªŒ Markdown)             â”‚
â”‚  è·¯å¾„: /opt/hl-os/data/obsidian/                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å±‚çº§3: åŸå§‹æ–‡ä»¶ç›®å½• (åŸå§‹èµ„æº/å­˜è¯å¤‡ä»½)                   â”‚
â”‚  â”œâ”€ images/  (åŸå§‹å›¾ç‰‡ - æŒ‰æœˆå½’æ¡£)                       â”‚
â”‚  â””â”€ books/   (ç”µå­æ•™æ PDF/EPUB/TXT)                    â”‚
â”‚  è·¯å¾„: /opt/hl-os/data/originals/                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ•°æ®æµå‘**ï¼š
1. ç”¨æˆ·ä¸Šä¼  â†’ åç«¯ä¿å­˜åŸå§‹ï¿½ï¿½ï¿½ä»¶åˆ° `originals/` + Obsidian Markdownåˆ° `obsidian/`
2. åç«¯æ¨é€å…ƒæ•°æ®åˆ° AnythingLLMï¼ˆåŒ…å«æ–‡ä»¶è·¯å¾„é“¾æ¥ï¼‰
3. å‰ç«¯é€šè¿‡ API æŸ¥è¯¢ AnythingLLM â†’ è·å–æ–‡ä»¶è·¯å¾„ â†’ è¯»å– Markdown/PDF å†…å®¹

---

#### 5.0.2 ç›®å½•ç»“æ„è®¾è®¡

```bash
/opt/hl-os/data/
â”œâ”€â”€ obsidian/                    # Obsidianæ–‡ä»¶å¤¹ï¼ˆMarkdownå­˜å‚¨ï¼‰
â”‚   â”œâ”€â”€ Wrong_Problems/          # é”™é¢˜æœ¬
â”‚   â”‚   â”œâ”€â”€ å¤§å®/
â”‚   â”‚   â”‚   â”œâ”€â”€ æ•°å­¦/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ 2026-01-20_ä¸‰è§’å‡½æ•°è¯±å¯¼å…¬å¼_abc123.md
â”‚   â”‚   â”‚   â”œâ”€â”€ ç‰©ç†/
â”‚   â”‚   â”‚   â””â”€â”€ è‹±è¯­/
â”‚   â”‚   â”œâ”€â”€ äºŒå®/
â”‚   â”‚   â””â”€â”€ shared/              # å…±äº«é”™é¢˜ï¼ˆå…¨å®¶å¯è§ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ No_Problems/             # è¯•å·ä½œä¸šï¼ˆæ— é”™é¢˜ï¼‰
â”‚   â”‚   â”œâ”€â”€ å¤§å®/
â”‚   â”‚   â”‚   â”œâ”€â”€ æ•°å­¦/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ 2026-01-18_æœŸæœ«è€ƒè¯•å·_def456.md
â”‚   â”‚   â”‚   â””â”€â”€ è¯­æ–‡/
â”‚   â”‚   â””â”€â”€ äºŒå®/
â”‚   â”‚
â”‚   â””â”€â”€ Courses/                 # AIç”Ÿæˆçš„è¯¾ä»¶å’Œæµ‹éªŒ
â”‚       â”œâ”€â”€ å¤§å®/
â”‚       â”‚   â”œâ”€â”€ æ•°å­¦/
â”‚       â”‚   â”‚   â”œâ”€â”€ 2026-01-19_ç¬¬äºŒç« ä¸‰è§’å‡½æ•°è¯¾ä»¶.md
â”‚       â”‚   â”‚   â””â”€â”€ 2026-01-19_ç¬¬äºŒç« é…å¥—æµ‹éªŒ.md
â”‚       â”‚   â””â”€â”€ ç‰©ç†/
â”‚       â””â”€â”€ äºŒå®/
â”‚
â”œâ”€â”€ originals/                   # åŸå§‹æ–‡ä»¶å­˜å‚¨
â”‚   â”œâ”€â”€ images/                  # åŸå§‹å›¾ç‰‡ï¼ˆæŒ‰æœˆå½’æ¡£ï¼‰
â”‚   â”‚   â””â”€â”€ 2026-01/             # YYYY-MM/
â”‚   â”‚       â”œâ”€â”€ 20_143022_abc123.jpg      # 20å·14:30:22ä¸Šä¼ 
â”‚   â”‚       â”œâ”€â”€ 20_150830_def456.jpg
â”‚   â”‚       â””â”€â”€ 21_091510_ghi789.png
â”‚   â”‚
â”‚   â””â”€â”€ books/                   # ç”µå­æ•™æï¼ˆæŒ‰æœˆå½’æ¡£ï¼‰
â”‚       â””â”€â”€ 2026-01/
â”‚           â”œâ”€â”€ é«˜ä¸­æ•°å­¦å¿…ä¿®1.pdf
â”‚           â”œâ”€â”€ é«˜ä¸­è‹±è¯­å¿…ä¿®3.epub
â”‚           â””â”€â”€ åˆä¸­ç‰©ç†å…«å¹´çº§.txt
â”‚
â””â”€â”€ metadata.json                # è½»é‡çº§å…ƒæ•°æ®ç´¢å¼•ï¼ˆå¯é€‰ï¼‰
    # ç”¨äºå¿«é€ŸæŸ¥è¯¢ã€ç»Ÿè®¡ã€å¤‡ä»½
    # æ ¼å¼ï¼šJSONæ•°ç»„ï¼ŒåŒ…å«æ‰€æœ‰æ–‡æ¡£çš„å…ƒæ•°æ®æ‘˜è¦
```

**æ–‡ä»¶å‘½åè§„èŒƒ**ï¼š
- Markdownæ–‡ä»¶ï¼š`æ—¥æœŸ_ä¸»é¢˜_å”¯ä¸€ID.md`
- åŸå§‹å›¾ç‰‡ï¼š`DD_HHMMSS_å”¯ä¸€ID.jpg`
- æ•™ææ–‡ä»¶ï¼š`åŸæ–‡ä»¶å`ï¼ˆä¿ç•™ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶åï¼‰

**ç›®å½•åˆ†ç»„è§„èŒƒ**ï¼š
- æŒ‰ç”¨æˆ·åˆ†ç»„ï¼ˆ`å¤§å®`/`äºŒå®`/`shared`ï¼‰
- æŒ‰å­¦ç§‘åˆ†ç»„ï¼ˆæ•°å­¦/è¯­æ–‡/è‹±è¯­/ç‰©ç†/åŒ–å­¦...ï¼‰
- æŒ‰æ—¶é—´å½’æ¡£ï¼ˆ`YYYY-MM/`ï¼‰

---

#### 5.0.3 AnythingLLM å‘é‡æ•°æ®åº“é…ç½®

**æŠ€æœ¯æ ˆ**ï¼š
- å‘é‡æ•°æ®åº“ï¼š**LanceDB**ï¼ˆåµŒå…¥å¼ï¼Œæ— éœ€é¢å¤–è¿›ç¨‹ï¼‰
- Embeddingå¼•æ“ï¼š**Gemini text-embedding-004**
- å®¹å™¨é•œåƒï¼š`mintplexlabs/anythingllm:latest`
- æ•°æ®æŒä¹…åŒ–ï¼š`./anythingllm-storage:/app/server/storage`

**Dockeré…ç½®** (`docker-compose.yml`)ï¼š
```yaml
anythingllm:
  image: mintplexlabs/anythingllm:latest
  environment:
    - VECTOR_DB=lancedb                  # å‘é‡æ•°æ®åº“
    - EMBEDDING_ENGINE=gemini            # Embeddingå¼•æ“
    - GEMINI_EMBEDDING_MODEL=text-embedding-004
    - CHUNK_SIZE=800                     # æ–‡æœ¬åˆ†å—å¤§å°
    - CHUNK_OVERLAP=150                  # åˆ†å—é‡å 
    - MAX_CONCURRENT_CHUNKS=2            # å¹¶å‘æ•°ï¼ˆ2C4Gä¼˜åŒ–ï¼‰
  volumes:
    - ./anythingllm-storage:/app/server/storage
  deploy:
    resources:
      limits:
        memory: 2G
```

**å­˜å‚¨å†…å®¹**ï¼š
| æ•°æ®ç±»å‹ | æ–‡æœ¬å†…å®¹ | å…ƒæ•°æ®å­—æ®µ |
|---------|---------|-----------|
| ç”µå­æ•™æ | PDFæå–çš„å…¨æ–‡ | `filePath`, `ownerId`, `subject`, `grade`, `tags` |
| é”™é¢˜ | Obsidian Markdownå…¨æ–‡ | `mdPath`, `imagePath`, `ownerId`, `subject`, `chapter` |
| è¯•å·ä½œä¸š | Obsidian Markdownå…¨æ–‡ | `mdPath`, `imagePath`, `ownerId`, `subject`, `docType` |
| è¯¾ä»¶æµ‹éªŒ | Obsidian Markdownå…¨æ–‡ | `mdPath`, `ownerId`, `subject`, `chapter` |

**å…ƒæ•°æ®ç¤ºä¾‹**ï¼š
```json
{
  "filePath": "/opt/hl-os/data/originals/books/2026-01/é«˜ä¸­æ•°å­¦å¿…ä¿®1.pdf",
  "mdPath": "/opt/hl-os/data/obsidian/Wrong_Problems/å¤§å®/æ•°å­¦/2026-01-20_ä¸‰è§’å‡½æ•°é”™é¢˜.md",
  "imagePath": "/opt/hl-os/data/originals/images/2026-01/20_143022_abc123.jpg",
  "ownerId": "child_1",
  "subject": "æ•°å­¦",
  "chapter": "ä¸‰è§’å‡½æ•°",
  "docType": "wrong_problem",
  "timestamp": 1737360000,
  "hasWrongProblems": true
}
```

**APIæ¥å£**ï¼š
- `POST /api/anythingllm/index-book` - ç´¢å¼•æ•™æ
- `POST /api/anythingllm/index-scanned-item` - ç´¢å¼•æ‰«æé¡¹
- `POST /api/anythingllm/search` - RAGæ£€ç´¢

---

#### 5.0.4 Obsidian æ–‡ä»¶æ ¼å¼è§„èŒƒ

**Frontmatter (YAMLå‰ç½®)**ï¼š
```yaml
---
type: wrong_problem
subject: æ•°å­¦
chapter: ä¸‰è§’å‡½æ•°
knowledge_status: æœªæŒæ¡
owner: child_1
created: 2026-01-20T14:30:22.000Z
problems_count: 3
tags: [ä¸‰è§’å‡½æ•°, è¯±å¯¼å…¬å¼, é”™é¢˜]
---

# æ•°å­¦ - ä¸‰è§’å‡½æ•°è¯±å¯¼å…¬å¼é”™é¢˜

## åŸé¢˜å†…å®¹

### é¢˜ç›® 1: (1)

**åŸé¢˜å†…å®¹ï¼š**
æ±‚ $\sin(210Â°)$ çš„å€¼

**å­¦ç”Ÿä½œç­”ï¼š**
1/3

**æ•™å¸ˆæ‰¹æ”¹ï¼š**
å…¬å¼è®°é”™äº†ï¼Œåº”è¯¥æ˜¯ç¬¬ä¸‰è±¡é™ä¸ºè´Ÿå€¼

**è®¢æ­£è®°å½•ï¼š**
$\sin(210Â°) = -1/2$

**çŠ¶æ€ï¼š** âŒ é”™è¯¯

---

## AIåˆ†æ

**é”™å› ç±»å‹**ï¼šå…¬å¼è®°å¿†é”™è¯¯
**æ¶‰åŠçŸ¥è¯†ç‚¹**ï¼šä¸‰è§’å‡½æ•°è¯±å¯¼å…¬å¼ã€è±¡é™ç¬¦å·
**æ¨èç»ƒä¹ **ï¼šç¬¬2ç« ç»ƒä¹ å†Œ 15-20é¢˜
```

**æ–‡ä»¶è·¯å¾„ä½œä¸ºå”¯ä¸€æ ‡è¯†**ï¼š
- åŒä¸€ä¸ªé”™é¢˜/è¯•å·çš„Markdownæ–‡ä»¶å’ŒåŸå§‹å›¾ç‰‡é€šè¿‡å…ƒæ•°æ®å…³è”
- AnythingLLMå­˜å‚¨çš„ `mdPath` å’Œ `imagePath` æŒ‡å‘è¿™ä¸¤ä¸ªæ–‡ä»¶

---

#### 5.0.5 æ•°æ®å­˜å‚¨ç­–ç•¥å¯¹æ¯”

| å†…å®¹ç±»å‹ | AnythingLLM | Obsidian | åŸå§‹æ–‡ä»¶ | è¯´æ˜ |
|---------|-------------|----------|---------|------|
| **ç”µå­æ•™æ** | âœ… å…¨é‡å­˜å‚¨ï¼ˆHot/å¯æœç´¢ï¼‰ | âŒ ä»…å­˜MOCç´¢å¼• | âœ… åŸå§‹PDF/EPUB | PDFæ–‡æœ¬å‘é‡åŒ–ç”¨äºRAG |
| **åŸå§‹å›¾ç‰‡** | âœ… å…¨é‡å­˜å‚¨ï¼ˆCold/ä¸æœç´¢ï¼‰ | âŒ | âœ… åŸå§‹JPG/PNG | å­˜è¯å¤‡ä»½ |
| **OCRè¯•å·ä½œä¸š** | ç´¢å¼•é“¾æ¥ | âœ… æ°¸ä¹…å­˜å‚¨ | âŒ | `No_Problems/` |
| **OCRé”™é¢˜** | ç´¢å¼•é“¾æ¥ | âœ… æ°¸ä¹…å­˜å‚¨ | âœ… åŸå§‹å›¾ç‰‡ | `Wrong_Problems/` |
| **AIè¯¾ä»¶æµ‹éªŒ** | ç´¢å¼•é“¾æ¥ | âœ… æ°¸ä¹…å­˜å‚¨ | âŒ | `Courses/` |

**å­˜å‚¨åŸåˆ™**ï¼š
- **AnythingLLM**ï¼šç”¨äºRAGæ£€ç´¢çš„çƒ­æ•°æ®ï¼ˆæ–‡æœ¬å‘é‡åŒ– + æ–‡ä»¶è·¯å¾„å…ƒæ•°æ®ï¼‰
- **Obsidian**ï¼šç”¨æˆ·å¯é˜…è¯»çš„ç»“æ„åŒ–å†…å®¹ï¼ˆMarkdownæ ¼å¼ï¼Œä¾¿äºç¼–è¾‘å’Œå¯¼å‡ºï¼‰
- **åŸå§‹æ–‡ä»¶**ï¼šä¸å¯æ›¿ä»£çš„åŸå§‹èµ„æºï¼ˆPDF/EPUB/å›¾ç‰‡ï¼‰

**èµ„æºå ç”¨ä¼°ç®—ï¼ˆ2C4GæœåŠ¡å™¨ï¼‰**ï¼š
- AnythingLLMï¼ˆLanceDBï¼‰ï¼š~500MBï¼ˆ1000ä»½æ–‡æ¡£ï¼‰
- Obsidianæ–‡ä»¶å¤¹ï¼š~10MBï¼ˆ1000ä»½Markdownï¼Œå¹³å‡10KB/ä»½ï¼‰
- åŸå§‹æ–‡ä»¶ï¼š~2GBï¼ˆ100ä¸ªPDFæ•™æ + 1000å¼ å›¾ç‰‡ï¼‰
- **æ€»è®¡**ï¼š~2.5GBï¼ˆå®Œå…¨å¯æ¥å—ï¼‰

---

#### 5.0.6 æ•°æ®å¤‡ä»½ä¸æ¢å¤

**å¤‡ä»½ç­–ç•¥**ï¼š
```bash
#!/bin/bash
# æ¯æ—¥å¤‡ä»½è„šæœ¬ /opt/hl-os/scripts/backup.sh

DATE=$(date +%Y%m%d)
BACKUP_DIR=/opt/hl-os/backups/$DATE

mkdir -p $BACKUP_DIR

# 1. å¤‡ä»½ Obsidian æ–‡ä»¶å¤¹
tar -czf $BACKUP_DIR/obsidian.tar.gz /opt/hl-os/data/obsidian/

# 2. å¤‡ä»½åŸå§‹æ–‡ä»¶
tar -czf $BACKUP_DIR/originals.tar.gz /opt/hl-os/data/originals/

# 3. å¤‡ä»½ AnythingLLM å‘é‡æ•°æ®åº“
tar -czf $BACKUP_DIR/anythingllm.tar.gz /opt/hl-os/anythingllm-storage/

# 4. å¤‡ä»½å…ƒæ•°æ®ç´¢å¼•
cp /opt/hl-os/data/metadata.json $BACKUP_DIR/

echo "å¤‡ä»½å®Œæˆ: $BACKUP_DIR"
```

**æ¢å¤ç­–ç•¥**ï¼š
```bash
#!/bin/bash
# æ¢å¤è„šæœ¬ /opt/hl-os/scripts/restore.sh

BACKUP_DIR=$1  # ä¾‹å¦‚: /opt/hl-os/backups/20260120

# 1. æ¢å¤ Obsidian æ–‡ä»¶å¤¹
tar -xzf $BACKUP_DIR/obsidian.tar.gz -C /

# 2. æ¢å¤åŸå§‹æ–‡ä»¶
tar -xzf $BACKUP_DIR/originals.tar.gz -C /

# 3. æ¢å¤ AnythingLLM
tar -xzf $BACKUP_DIR/anythingllm.tar.gz -C /opt/hl-os/

# 4. é‡å¯å®¹å™¨
docker-compose restart anythingllm backend

echo "æ¢å¤å®Œæˆ"
```

**è‡ªåŠ¨åŒ–å¤‡ä»½ï¼ˆCronï¼‰**ï¼š
```bash
# æ¯æ—¥å‡Œæ™¨3ç‚¹æ‰§è¡Œå¤‡ä»½
0 3 * * * /opt/hl-os/scripts/backup.sh

# ä¿ç•™æœ€è¿‘30å¤©çš„å¤‡ä»½
0 4 * * * find /opt/hl-os/backups -type d -mtime +30 -exec rm -rf {} \;
```

---

### 5.1 æ ¸å¿ƒç±»å‹å®šä¹‰ (`types.ts`)

#### UserProfile (ç”¨æˆ·æ¡£æ¡ˆ)
```typescript
interface UserProfile {
  id: string;              // 'child_1' | 'child_2' | 'shared'
  name: string;            // 'å¤§å®' | 'äºŒå®'
  avatar: string;          // å¤´åƒURLæˆ–Emoji
  grade: string;           // 'é«˜ä¸­äºŒå¹´çº§' | 'åˆä¸­ä¸€å¹´çº§'
}
```

#### ScannedItem (æ‰«æé¡¹)
```typescript
interface ScannedItem {
  id: string;                          // UUID
  ownerId: string;                     // 'child_1' | 'child_2' | 'shared'
  timestamp: number;                   // Unixæ—¶é—´æˆ³
  imageUrl: string;                    // base64 æˆ– URL
  rawMarkdown: string;                 // AIç”Ÿæˆçš„Markdownæ–‡æœ¬
  meta: StructuredMetaData;            // ç»“æ„åŒ–å…ƒæ•°æ®
  status: ProcessingStatus;            // å¤„ç†çŠ¶æ€
  anythingLlmIndexed?: boolean;        // æ˜¯å¦å·²ç´¢å¼•åˆ°RAG
}
```

#### StructuredMetaData (AIè§£æå…ƒæ•°æ®)
```typescript
interface StructuredMetaData {
  type: DocType;                       // æ–‡æ¡£ç±»å‹æšä¸¾
  subject: string;                     // 'æ•°å­¦' | 'è¯­æ–‡' | 'è‹±è¯­' | 'ç‰©ç†' ...
  chapter_hint?: string;               // ç« èŠ‚æç¤º (AIæ¨æµ‹)
  knowledge_status?: 'å·²ç»æŒæ¡' | 'æœªæŒæ¡' | 'éœ€åŠ å¼º';
  frontmatter?: string;                // Obsidian YAMLå‰ç½®
  problems?: ProblemUnit[];            // é¢˜ç›®æ•°ç»„
}
```

#### ProblemUnit (é¢˜ç›®å•å…ƒ)
```typescript
interface ProblemUnit {
  id: string;                          // UUID
  questionNumber: string;              // '1' | '(1)' | 'a)'
  content: string;                     // é¢˜ç›®æ–‡æœ¬ (å¯å«LaTeX)
  studentAnswer: string;               // å­¦ç”Ÿç­”æ¡ˆ
  teacherComment: string;              // æ•™å¸ˆæ‰¹æ³¨
  status: ProblemStatus;               // 'CORRECT' | 'WRONG' | 'CORRECTED'
}
```

#### EBook (ç”µå­æ•™æ)
```typescript
interface EBook {
  id: string;
  title: string;
  author?: string;
  fileFormat: 'pdf' | 'epub' | 'txt';
  fileSize: number;                    // å­—èŠ‚æ•°
  uploadedAt: number;                  // Unixæ—¶é—´æˆ³
  ownerId: string;

  // AIæå–çš„å…ƒæ•°æ®
  subject: string;
  category: string;                    // 'æ•™æ' | 'å‚è€ƒä¹¦' | 'ä¹ é¢˜é›†'
  grade: string;
  tags: string[];

  // ç›®å½•ç»“æ„
  tableOfContents: ChapterNode[];

  // RAGé›†æˆ
  indexStatus: IndexStatus;            // 'PENDING' | 'INDEXING' | 'INDEXED' | 'FAILED'
  anythingLlmDocId?: string;
}
```

#### ChapterNode (ç« èŠ‚æ ‘èŠ‚ç‚¹)
```typescript
interface ChapterNode {
  id: string;
  title: string;
  level: 1 | 2 | 3;                    // ç« /èŠ‚/å°èŠ‚
  pageRange?: {
    start: number;
    end: number;
  };
  children: ChapterNode[];             // é€’å½’å­èŠ‚ç‚¹
}
```

### 5.2 æšä¸¾ç±»å‹

#### DocType (æ–‡æ¡£ç±»å‹)
```typescript
enum DocType {
  TEXTBOOK = 'textbook',               // æ•™æå†…å®¹
  NOTE = 'note',                       // å­¦ä¹ ç¬”è®°
  WRONG_PROBLEM = 'wrong_problem',     // é”™é¢˜æœ¬
  EXAM_PAPER = 'exam_paper',           // è€ƒå·
  COURSEWARE = 'å­¦ä¹ å®Œæˆçš„è¯¾ä»¶',        // AIç”Ÿæˆè¯¾ä»¶
  KNOWLEDGE_CARD = 'çŸ¥è¯†å¡ç‰‡',          // çŸ¥è¯†ç‚¹å¡ç‰‡
  MOCK_EXAM = 'æ¨¡æ‹Ÿè€ƒè¯•',               // æ¨¡æ‹Ÿè€ƒè¯•
  HOMEWORK = 'ä½œä¸š',                    // æ—¥å¸¸ä½œä¸š
  TUTOR_SESSION = 'è¾…å¯¼è®°å½•',           // AIè¾…å¯¼è®°å½•
  UNKNOWN = 'unknown'
}
```

#### ProcessingStatus (å¤„ç†çŠ¶æ€)
```typescript
enum ProcessingStatus {
  IDLE = 'idle',                       // æœªå¼€å§‹
  SCANNING = 'scanning',               // æ‰«æä¸­
  PROCESSED = 'processed',             // å·²å¤„ç†
  ERROR = 'error',                     // å¤„ç†å¤±è´¥
  INDEXING = 'indexing',               // ç´¢å¼•ä¸­
  ARCHIVED = 'archived'                // å·²å½’æ¡£
}
```

#### ProblemStatus (é¢˜ç›®çŠ¶æ€)
```typescript
enum ProblemStatus {
  CORRECT = 'CORRECT',                 // æ­£ç¡®
  WRONG = 'WRONG',                     // é”™è¯¯
  CORRECTED = 'CORRECTED'              // å·²è®¢æ­£
}
```

---

## 6. APIè®¾è®¡

### 6.1 APIåŸºç¡€ä¿¡æ¯

**åŸºç¡€URL**:
- å¼€å‘ç¯å¢ƒ: `http://localhost:3000/api`
- ç”Ÿäº§ç¯å¢ƒ: `https://<your-domain>/api`

**è®¤è¯æ–¹å¼**:
- Gemini API Key (åç«¯é…ç½®ç¯å¢ƒå˜é‡)
- AnythingLLM API Key (å¯é€‰)

**é€šç”¨å“åº”æ ¼å¼**:
```typescript
{
  success: boolean;
  data?: any;              // æˆåŠŸæ—¶çš„æ•°æ®
  error?: string;          // å¤±è´¥æ—¶çš„é”™è¯¯æ¶ˆæ¯
}
```

### 6.2 æ ¸å¿ƒAPIç«¯ç‚¹

#### 1. POST /api/analyze-image (å›¾åƒåˆ†æ)

**è¯·æ±‚**:
```json
{
  "base64Image": "data:image/jpeg;base64,/9j/4AAQSkZJRg..."
}
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "text": "# æ•°å­¦é”™é¢˜\n\n## ç¬¬1é¢˜\n...",
    "meta": {
      "type": "wrong_problem",
      "subject": "æ•°å­¦",
      "chapter_hint": "ä¸‰è§’å‡½æ•°",
      "knowledge_status": "éœ€åŠ å¼º",
      "frontmatter": "---\ntags: [ä¸‰è§’å‡½æ•°, è¯±å¯¼å…¬å¼]\n---",
      "problems": [
        {
          "id": "uuid-1",
          "questionNumber": "1",
          "content": "æ±‚ sin(Ï€/6) çš„å€¼",
          "studentAnswer": "1/3",
          "teacherComment": "å…¬å¼è®°é”™äº†",
          "status": "WRONG"
        }
      ]
    }
  }
}
```

**é”™è¯¯ç **:
- 400: è¯·æ±‚æ ¼å¼é”™è¯¯ (ç¼ºå°‘base64Image)
- 429: Gemini APIé…é¢è¶…é™
- 503: ç½‘ç»œè¿æ¥å¤±è´¥

#### 2. POST /api/generate-courseware (ç”Ÿæˆè¯¾ä»¶)

**è¯·æ±‚**:
```json
{
  "bookTitle": "é«˜ä¸­æ•°å­¦å¿…ä¿®1",
  "chapter": "ç¬¬äºŒç«  ä¸‰è§’å‡½æ•°",
  "studentName": "å¤§å®",
  "subject": "æ•°å­¦",
  "teachingStyle": "rigorous",
  "wrongProblems": [...]
}
```

**å“åº”**:
```json
{
  "success": true,
  "data": "# ç¬¬äºŒç«  ä¸‰è§’å‡½æ•°\n\n## 2.1 å¼§åº¦åˆ¶\n\n### æ ¸å¿ƒæ¦‚å¿µ\n..."
}
```

**æ¨¡å‹é…ç½®**:
- æ¨¡å‹: `gemini-3-flash-preview`
- æ¸©åº¦: 0.7
- ç³»ç»ŸæŒ‡ä»¤: "ä½ æ˜¯ä¸€ä½èµ„æ·±å­¦ç§‘ä¸“å®¶ã€‚è¯·æ ¹æ®å­¦ç”Ÿçš„è®¤çŸ¥ç¨‹åº¦ç”Ÿæˆé«˜è´¨é‡ Markdown è¯¾ä»¶ã€‚"

#### 3. POST /api/generate-assessment (ç”Ÿæˆæµ‹éªŒ)

**è¯·æ±‚**:
```json
{
  "bookTitle": "é«˜ä¸­æ•°å­¦å¿…ä¿®1",
  "subject": "æ•°å­¦",
  "chapter": "ç¬¬äºŒç«  ä¸‰è§’å‡½æ•°",
  "studentName": "å¤§å®",
  "wrongProblems": [...],
  "coursewareContent": "# ç¬¬äºŒç«  ä¸‰è§’å‡½æ•°\n\n..."
}
```

**å“åº”**:
```json
{
  "success": true,
  "data": "# é…å¥—æµ‹éªŒå·\n\n## ä¸€ã€é€‰æ‹©é¢˜\n\n1. ...\n\n## äºŒã€å¡«ç©ºé¢˜\n..."
}
```

**å‡ºé¢˜è§„åˆ™**:
- æ¯ä¸ªæ ¸å¿ƒçŸ¥è¯†ç‚¹: 2é“åŸºç¡€é¢˜ + 1é“æé«˜é¢˜
- éš¾åº¦åˆ†é…: 70%åŸºç¡€ + 30%æé«˜
- è‹¥æœ‰å†å²é”™é¢˜: é’ˆå¯¹è–„å¼±ç¯èŠ‚å‡ºå˜å¼

#### 4. POST /api/upload-book (æ•™æä¸Šä¼ )

**è¯·æ±‚** (multipart/form-data):
```
file: <PDF/EPUB/TXTæ–‡ä»¶>
ownerId: 'child_1'
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "fileName": "é«˜ä¸­æ•°å­¦å¿…ä¿®1.pdf",
    "fileFormat": "pdf",
    "fileSize": 10485760,
    "pageCount": 120,
    "content": "ç¬¬ä¸€ç«  é›†åˆ...",
    "metadata": {
      "title": "é«˜ä¸­æ•°å­¦å¿…ä¿®1",
      "subject": "æ•°å­¦",
      "grade": "é«˜ä¸­ä¸€å¹´çº§",
      "category": "æ•™æ",
      "tags": ["é›†åˆ", "å‡½æ•°", "ä¸‰è§’å‡½æ•°"],
      "tableOfContents": [...]
    }
  }
}
```

**æ–‡ä»¶é™åˆ¶**:
- æœ€å¤§æ–‡ä»¶å¤§å°: 100MB
- æ”¯æŒæ ¼å¼: PDF, EPUB, TXT

#### 5. POST /api/anythingllm/index-book (RAGç´¢å¼•)

**è¯·æ±‚**:
```json
{
  "bookId": "uuid-123",
  "title": "é«˜ä¸­æ•°å­¦å¿…ä¿®1",
  "content": "...",
  "metadata": {...}
}
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "docId": "anythingllm-doc-456",
    "status": "indexed"
  }
}
```

---

## 7. æ ¸å¿ƒä¸šåŠ¡æµç¨‹

### 7.1 é”™é¢˜å½•å…¥æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ (ç›¸æœº/ç›¸å†Œ)                              â”‚
â”‚     CaptureModule.handleFileChange()                    â”‚
â”‚     - å›¾ç‰‡é¢„è§ˆ                                           â”‚
â”‚     - base64ç¼–ç                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. ç‚¹å‡»"åˆ†æ"æŒ‰é’®                                        â”‚
â”‚     CaptureModule.handleProcess()                       â”‚
â”‚     - setStatus('SCANNING')                             â”‚
â”‚     - fetch('/api/analyze-image', { base64Image })      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. åç«¯AIå¤„ç†                                            â”‚
â”‚     /api/analyze-image                                  â”‚
â”‚     - GoogleGenAI.generateContent()                     â”‚
â”‚     - 4å±‚OCRè§£æ„åè®®                                     â”‚
â”‚     - Schemaå¼ºåˆ¶JSONæ ¼å¼                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. å‰ç«¯å®¡æ ¸ç•Œé¢                                          â”‚
â”‚     - ReactMarkdownæ¸²æŸ“æ–‡æœ¬                              â”‚
â”‚     - ProblemUnitåˆ—è¡¨ç¼–è¾‘                                â”‚
â”‚     - ç”¨æˆ·å¯ä¿®æ”¹status (CORRECT/WRONG/CORRECTED)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. ç¡®è®¤å½’æ¡£                                              â”‚
â”‚     CaptureModule.handleSaveAndArchive()                â”‚
â”‚     - onScanComplete(ScannedItem)                       â”‚
â”‚     - App.tsx: scannedItems.push(newItem)               â”‚
â”‚     - confettiåº†ç¥åŠ¨ç”»                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 æ•™æä¸Šä¼ ä¸ç´¢å¼•æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ç”¨æˆ·é€‰æ‹©æ–‡ä»¶                                          â”‚
â”‚     LibraryHub â†’ BookUploader                           â”‚
â”‚     - æ‹–æ‹½/ç‚¹å‡»é€‰æ‹©                                      â”‚
â”‚     - æ–‡ä»¶æ ¼å¼éªŒè¯                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. ä¸Šä¼ åˆ°åç«¯                                            â”‚
â”‚     POST /api/upload-book (multipart/form-data)         â”‚
â”‚     - Multeræ¥æ”¶æ–‡ä»¶ (æœ€å¤§100MB)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. æ–‡ä»¶è§£æ                                              â”‚
â”‚     - åˆ¤æ–­æ ¼å¼ (PDF/EPUB/TXT)                           â”‚
â”‚     - pdfParser.parse() / epubParser.parse()            â”‚
â”‚     - æå–æ–‡æœ¬å†…å®¹ + ç« èŠ‚ç›®å½•                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. AIå…ƒæ•°æ®æå–                                          â”‚
â”‚     bookMetadataAnalyzer.analyzeBookMetadata()          â”‚
â”‚     - Geminiåˆ†æå†…å®¹ç‰‡æ®µ                                 â”‚
â”‚     - æå–: æ ‡é¢˜ã€å­¦ç§‘ã€å¹´çº§ã€æ ‡ç­¾ã€ç›®å½•                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. å‰ç«¯å…ƒæ•°æ®ç¼–è¾‘                                        â”‚
â”‚     BookMetadataEditor                                  â”‚
â”‚     - ç”¨æˆ·å¯ä¿®æ­£AIæå–çš„å…ƒæ•°æ®                           â”‚
â”‚     - ç¼–è¾‘ç« èŠ‚ç›®å½•æ ‘                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. ä¿å­˜åˆ°IndexedDB                                      â”‚
â”‚     bookStorage.saveBook(eBook)                         â”‚
â”‚     - æµè§ˆå™¨æœ¬åœ°æŒä¹…åŒ–                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. å¯é€‰: RAGç´¢å¼•                                         â”‚
â”‚     POST /api/anythingllm/index-book                    â”‚
â”‚     - å‘é‡åŒ–å­˜å‚¨ç”¨äºä¸Šä¸‹æ–‡æ£€ç´¢                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 ä¸ªæ€§åŒ–å­¦ä¹ æµç¨‹ (StudyRoom)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤1: é€‰æ‹©ç« èŠ‚ (ChapterSelector)                        â”‚
â”‚  - ä»å›¾ä¹¦é¦†é€‰æ‹©æ•™æ                                       â”‚
â”‚  - æ ‘å½¢ç›®å½•é€‰æ‹©å…·ä½“ç« èŠ‚                                   â”‚
â”‚  - handleChapterSelect(book, chapter)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤2: ç”Ÿæˆè¯¾ä»¶ (CoursewareGenerator)                    â”‚
â”‚  - é€‰æ‹©æ•™å­¦é£æ ¼ (ä¸¥è°¨/æ•…äº‹åŒ–/å®è·µ/æ¢ç©¶)                   â”‚
â”‚  - æ™ºèƒ½æç¤º: è‹¥æœ‰å†å²é”™é¢˜ï¼Œä¼˜å…ˆè®²è§£                       â”‚
â”‚  - POST /api/generate-courseware                        â”‚
â”‚  - æ˜¾ç¤ºMarkdownè¯¾ä»¶                                      â”‚
â”‚  - å¯ä¸‹è½½/é‡æ–°ç”Ÿæˆ                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤3: é…å¥—æµ‹éªŒ (QuizGenerator)                          â”‚
â”‚  - åŸºäºè¯¾ä»¶å†…å®¹ + å†å²é”™é¢˜                                â”‚
â”‚  - POST /api/generate-assessment                        â”‚
â”‚  - 70%åŸºç¡€é¢˜ + 30%æé«˜é¢˜                                 â”‚
â”‚  - Markdownæ¸²æŸ“ + ä¸‹è½½                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.4 æ™ºèƒ½ç»„å·æµç¨‹ (ExamCenter)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ç”¨æˆ·é€‰æ‹©å‚æ•°                                          â”‚
â”‚     - å­¦ç§‘ã€ç« èŠ‚èŒƒå›´                                      â”‚
â”‚     - éš¾åº¦çº§åˆ« (ç®€å•/ä¸­ç­‰/å›°éš¾)                           â”‚
â”‚     - é¢˜å‹åˆ†é… (é€‰æ‹©/å¡«ç©º/è§£ç­”)                           â”‚
â”‚     - æ—¶é—´é™åˆ¶                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. ç³»ç»Ÿæå–è–„å¼±çŸ¥è¯†ç‚¹                                     â”‚
â”‚     - ä» wrongProblems[] åˆ†æ                            â”‚
â”‚     - ç»Ÿè®¡é«˜é¢‘é”™è¯¯ç±»å‹                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. RAGä¸Šä¸‹æ–‡æ£€ç´¢ (AnythingLLM)                          â”‚
â”‚     - æŸ¥è¯¢ç›¸ä¼¼é¢˜ç›®                                        â”‚
â”‚     - æå–æ•™æç›¸å…³ç« èŠ‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. Geminiç”Ÿæˆé¢˜ç›®                                        â”‚
â”‚     - é’ˆå¯¹è–„å¼±ç‚¹ç”Ÿæˆå˜å¼é¢˜                                â”‚
â”‚     - æŒ‰éš¾åº¦åˆ†é…é¢˜ç›®æ•°é‡                                  â”‚
â”‚     - ç”Ÿæˆæ ‡å‡†ç­”æ¡ˆå’Œè¯¦ç»†è§£æ                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. ç»„è£…è¯•å·                                              â”‚
â”‚     - Markdownæ ¼å¼æ’ç‰ˆ                                   â”‚
â”‚     - åŒ…å«ç­”é¢˜å¡ã€ç­”æ¡ˆåŒºã€è§£æåŒº                          â”‚
â”‚     - å¯æ‰“å°/å¯¼å‡º                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. éƒ¨ç½²æ¶æ„

### 8.1 ç”Ÿäº§ç¯å¢ƒ (Docker Compose)

**docker-compose.yml**:
```yaml
version: '3.8'

services:
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
      - ./frontend/dist:/usr/share/nginx/html
    depends_on:
      - backend
      - anythingllm
    networks:
      - hl-network

  backend:
    build: ./backend
    environment:
      - NODE_ENV=production
      - PORT=3000
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - ANYTHINGLLM_ENDPOINT=http://anythingllm:3001
      - ANYTHINGLLM_API_KEY=${ANYTHINGLLM_API_KEY}
    ports:
      - "3000:3000"
    volumes:
      - ./backend/uploads:/app/uploads
    networks:
      - hl-network

  anythingllm:
    image: mintplexlabs/anythingllm:latest
    environment:
      - STORAGE_DIR=/app/storage
    ports:
      - "3001:3001"
    volumes:
      - anythingllm_data:/app/storage
    networks:
      - hl-network

networks:
  hl-network:
    driver: bridge

volumes:
  anythingllm_data:
```

### 8.2 Nginxé…ç½®

**nginx.conf**:
```nginx
upstream backend {
    server backend:3000;
}

upstream anythingllm {
    server anythingllm:3001;
}

server {
    listen 80;
    server_name hl-os.example.com;
    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl http2;
    server_name hl-os.example.com;

    ssl_certificate /etc/nginx/ssl/fullchain.pem;
    ssl_certificate_key /etc/nginx/ssl/privkey.pem;

    # é™æ€èµ„æº
    location / {
        root /usr/share/nginx/html;
        try_files $uri $uri/ /index.html;
    }

    # APIä»£ç†
    location /api/ {
        proxy_pass http://backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

        # å¤§æ–‡ä»¶ä¸Šä¼ 
        client_max_body_size 100M;
        proxy_request_buffering off;
    }

    # AnythingLLMä»£ç†
    location /anythingllm/ {
        proxy_pass http://anythingllm/;
        proxy_set_header Host $host;
    }
}
```

### 8.3 SystemdæœåŠ¡ç®¡ç†

**hl-backend.service**:
```ini
[Unit]
Description=HL-OS Backend Service
After=network.target

[Service]
Type=simple
User=www-data
WorkingDirectory=/opt/hl-os/backend
Environment="NODE_ENV=production"
Environment="PORT=3000"
EnvironmentFile=/opt/hl-os/backend/.env
ExecStart=/usr/bin/node /opt/hl-os/backend/dist/index.js
Restart=on-failure
RestartSec=10

[Install]
WantedBy=multi-user.target
```

**ç®¡ç†å‘½ä»¤**:
```bash
# å¯åŠ¨æœåŠ¡
sudo systemctl start hl-backend

# åœæ­¢æœåŠ¡
sudo systemctl stop hl-backend

# é‡å¯æœåŠ¡
sudo systemctl restart hl-backend

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status hl-backend

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u hl-backend -f
```

### 8.4 éƒ¨ç½²æµç¨‹

```bash
# 1. æ‹‰å–æœ€æ–°ä»£ç 
cd /opt/hl-os
git pull origin master

# 2. æ„å»ºå‰ç«¯
cd frontend
npm install
npm run build

# 3. æ„å»ºåç«¯
cd ../backend
npm install
npm run build

# 4. é‡å¯æœåŠ¡
sudo systemctl restart hl-backend
sudo docker-compose restart nginx

# 5. éªŒè¯éƒ¨ç½²
curl https://hl-os.example.com/api/health
```

---

## 9. å·²çŸ¥é™åˆ¶ä¸ä¼˜åŒ–æ–¹å‘

### 9.1 åŠŸèƒ½å±‚é¢

**å·²çŸ¥é™åˆ¶**:
1. âŒ **æ— çœŸå®æ•°æ®åº“**: å‰ç«¯ä¾èµ–IndexedDBï¼Œæ•°æ®æ— æ³•è·¨è®¾å¤‡åŒæ­¥
2. âŒ **æ— ç”¨æˆ·è®¤è¯**: å¤šç”¨æˆ·åˆ‡æ¢åŸºäºæœ¬åœ°çŠ¶æ€ï¼Œæ— åç«¯éªŒè¯
3. âŒ **ç»Ÿè®¡æ•°æ®ç¡¬ç¼–ç **: Dashboardéƒ¨åˆ†æ•°æ®ä¸ºé™æ€æ•°æ®
4. âŒ **æ— çœŸå®è€ƒè¯•æ¨¡å¼**: ExamCenterå°šæœªå®ç°è®¡æ—¶å™¨å’Œè‡ªåŠ¨æ‰¹æ”¹
5. âŒ **AnythingLLMé›†æˆä¸å®Œæ•´**: RAGæ£€ç´¢å°šæœªåœ¨æ‰€æœ‰åŠŸèƒ½ä¸­å¯ç”¨

**ä¼˜åŒ–æ–¹å‘**:
1. âœ… **å¼•å…¥åç«¯æ•°æ®åº“** (PostgreSQL + Prisma)
   - ç”¨æˆ·è®¤è¯ (JWT)
   - æ•°æ®æŒä¹…åŒ–
   - è·¨è®¾å¤‡åŒæ­¥

2. âœ… **å®Œå–„ç»Ÿè®¡åŠŸèƒ½**
   - çœŸå®å­¦ä¹ æ—¶é•¿ç»Ÿè®¡
   - çŸ¥è¯†ç‚¹æŒæ¡åº¦åˆ†æ
   - é”™é¢˜è¶‹åŠ¿å›¾è¡¨

3. âœ… **å¢å¼ºè€ƒè¯•æ¨¡å¼**
   - å€’è®¡æ—¶åŠŸèƒ½
   - è‡ªåŠ¨æäº¤
   - AIè‡ªåŠ¨æ‰¹æ”¹
   - æˆç»©æŠ¥å‘Šç”Ÿæˆ

4. âœ… **æ·±åº¦é›†æˆAnythingLLM**
   - æ‰€æœ‰AIç”ŸæˆåŠŸèƒ½æ¥å…¥RAG
   - æ•™æå…¨æ–‡æ£€ç´¢
   - æ™ºèƒ½é—®ç­”ç³»ç»Ÿ

### 9.2 æ€§èƒ½å±‚é¢

**å·²çŸ¥é—®é¢˜**:
1. âš ï¸ **å¤§æ–‡ä»¶ä¸Šä¼ é˜»å¡UI**: 100MB PDFä¸Šä¼ æ—¶æ— è¿›åº¦åé¦ˆ
2. âš ï¸ **é¦–æ¬¡åŠ è½½æ…¢**: æœªå®ç°ä»£ç åˆ†å‰² (Code Splitting)
3. âš ï¸ **å›¾ç‰‡æœªå‹ç¼©**: base64å­˜å‚¨å ç”¨å¤§é‡å†…å­˜

**ä¼˜åŒ–æ–¹æ¡ˆ**:
1. âœ… **åˆ†ç‰‡ä¸Šä¼ ** (Chunked Upload)
   - ä½¿ç”¨ `tus-js-client` åº“
   - æ–­ç‚¹ç»­ä¼ æ”¯æŒ

2. âœ… **ä»£ç åˆ†å‰²**
   ```typescript
   const LiveTutor = React.lazy(() => import('./components/LiveTutor'));
   ```

3. âœ… **å›¾ç‰‡å‹ç¼©**
   - å‰ç«¯ä½¿ç”¨ `browser-image-compression`
   - åç«¯ä½¿ç”¨ `sharp` åº“

4. âœ… **è™šæ‹Ÿæ»šåŠ¨**
   - KnowledgeHub ä½¿ç”¨ `react-window`
   - æå‡å¤§åˆ—è¡¨æ¸²æŸ“æ€§èƒ½

### 9.3 UI/UXå±‚é¢

**ä¼˜åŒ–æ–¹å‘**:
1. âœ… **é»‘æš—æ¨¡å¼** (Dark Mode)
   - Tailwind CSS `dark:` å˜ä½“
   - ç”¨æˆ·åå¥½æŒä¹…åŒ–

2. âœ… **ç§»åŠ¨ç«¯ä¼˜åŒ–**
   - æ‰‹åŠ¿æ“ä½œ (æ»‘åŠ¨è¿”å›)
   - åº•éƒ¨å®‰å…¨åŒºé€‚é… (safe-area-inset)

3. âœ… **æ— éšœç¢æ€§** (Accessibility)
   - ARIAæ ‡ç­¾
   - é”®ç›˜å¯¼èˆª
   - å±å¹•é˜…è¯»å™¨æ”¯æŒ

4. âœ… **é”™è¯¯è¾¹ç•Œ**
   - React Error Boundary
   - å‹å¥½çš„é”™è¯¯é¡µé¢

### 9.4 å®‰å…¨å±‚é¢

**æ½œåœ¨é£é™©**:
1. âš ï¸ **API Keyæš´éœ²**: å‰ç«¯æ„å»ºæ—¶æ³¨å…¥ï¼Œå¯é€šè¿‡DevToolsæŸ¥çœ‹
2. âš ï¸ **æ— XSSé˜²æŠ¤**: Markdownæ¸²æŸ“æœªè¿‡æ»¤å±é™©æ ‡ç­¾
3. âš ï¸ **æ— CSRFä¿æŠ¤**: APIæ— ä»¤ç‰ŒéªŒè¯

**å®‰å…¨åŠ å›º**:
1. âœ… **API Keyè¿ç§»åˆ°åç«¯**: å‰ç«¯ä»…è°ƒç”¨åç«¯API
2. âœ… **Markdownæ¶ˆæ¯’** (Sanitization)
   ```typescript
   import sanitizeHtml from 'sanitize-html';
   const cleanHtml = sanitizeHtml(rawHtml, {
     allowedTags: ['h1', 'h2', 'p', 'code', 'pre'],
     allowedAttributes: {}
   });
   ```

3. âœ… **CSRFä»¤ç‰Œ**
   - ä½¿ç”¨ `csurf` ä¸­é—´ä»¶
   - å‰ç«¯è¯·æ±‚æºå¸¦ `X-CSRF-Token` å¤´

4. âœ… **å†…å®¹å®‰å…¨ç­–ç•¥** (CSP)
   ```nginx
   add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline';";
   ```

---

## é™„å½•

### A. ç¯å¢ƒå˜é‡æ¸…å•

**å‰ç«¯** (`.env.local`):
```bash
# å·²åºŸå¼ƒï¼Œè¿ç§»åˆ°åç«¯
# API_KEY=<gemini_api_key>
```

**åç«¯** (`.env`):
```bash
NODE_ENV=production
PORT=3000

# Gemini API
GEMINI_API_KEY=<your_gemini_api_key>

# AnythingLLM (å¯é€‰)
ANYTHINGLLM_ENDPOINT=http://localhost:3001
ANYTHINGLLM_API_KEY=<your_anythingllm_token>

# æ•°æ®åº“ (æœªæ¥)
# DATABASE_URL=postgresql://user:password@localhost:5432/hl_os
```

### B. å¿«é€Ÿå‘½ä»¤é€ŸæŸ¥

```bash
# å¼€å‘ç¯å¢ƒå¯åŠ¨
npm run dev                  # å‰ç«¯ (port 5173)
cd backend && npm run dev    # åç«¯ (port 3000)

# ç”Ÿäº§æ„å»º
npm run build                # å‰ç«¯
cd backend && npm run build  # åç«¯

# ä»£ç æ£€æŸ¥
npx tsc --noEmit             # TypeScriptç±»å‹æ£€æŸ¥
npm run lint                 # ESLint (è‹¥é…ç½®)

# Dockeréƒ¨ç½²
docker-compose up -d         # å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose logs -f       # æŸ¥çœ‹æ—¥å¿—
docker-compose down          # åœæ­¢æœåŠ¡
```

### C. å…³é”®æ–‡ä»¶è·¯å¾„ç´¢å¼•

```
HL-os/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ Dashboard.tsx            # æ¦‚è§ˆé¢æ¿
â”‚   â”œâ”€â”€ LibraryHub.tsx           # å›¾ä¹¦é¦†
â”‚   â”œâ”€â”€ CaptureModule.tsx        # æ‹é¢˜å½•å…¥
â”‚   â”œâ”€â”€ StudyRoom.tsx            # AIå­¦ä¹ å›­åœ°
â”‚   â”œâ”€â”€ KnowledgeHub.tsx         # æ¡£æ¡ˆåº“
â”‚   â”œâ”€â”€ ExamCenter.tsx           # è€ƒè¯•ä¸­å¿ƒ
â”‚   â”œâ”€â”€ LiveTutor.tsx            # AIå®æ—¶è¾…å¯¼
â”‚   â””â”€â”€ ui/                      # UIç»„ä»¶åº“
â”‚       â”œâ”€â”€ Button.tsx
â”‚       â”œâ”€â”€ Card.tsx
â”‚       â”œâ”€â”€ Badge.tsx
â”‚       â””â”€â”€ LoadingSpinner.tsx
â”‚
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ index.ts             # Expresså…¥å£
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”œâ”€â”€ analyze.ts       # /api/analyze-image
â”‚   â”‚   â”‚   â”œâ”€â”€ courseware.ts    # /api/generate-courseware
â”‚   â”‚   â”‚   â”œâ”€â”€ assessment.ts    # /api/generate-assessment
â”‚   â”‚   â”‚   â”œâ”€â”€ upload-book.ts   # /api/upload-book
â”‚   â”‚   â”‚   â””â”€â”€ anythingllm.ts   # /api/anythingllm/*
â”‚   â”‚   â””â”€â”€ services/
â”‚   â”‚       â”œâ”€â”€ geminiService.ts          # Gemini APIå°è£…
â”‚   â”‚       â”œâ”€â”€ bookMetadataAnalyzer.ts   # å…ƒæ•°æ®æå–
â”‚   â”‚       â”œâ”€â”€ pdfParser.ts              # PDFè§£æ
â”‚   â”‚       â””â”€â”€ epubParser.ts             # EPUBè§£æ
â”‚   â”‚
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ types.ts                     # å…¨å±€ç±»å‹å®šä¹‰
â”œâ”€â”€ App.tsx                      # æ ¹ç»„ä»¶
â”œâ”€â”€ bookStorage.ts               # IndexedDBå°è£…
â”œâ”€â”€ tailwind.config.js           # Tailwindé…ç½®
â”œâ”€â”€ vite.config.ts               # Viteé…ç½®
â”œâ”€â”€ tsconfig.json                # TypeScripté…ç½®
â”œâ”€â”€ docker-compose.yml           # Dockerç¼–æ’
â””â”€â”€ docs/
    â””â”€â”€ PROJECT_OVERVIEW.md      # æœ¬æ–‡æ¡£
```

---

**æ–‡æ¡£ç»´æŠ¤è¯´æ˜**:
- æœ¬æ–‡æ¡£åº”åœ¨æ¯æ¬¡é‡å¤§åŠŸèƒ½æ›´æ–°ååŒæ­¥ä¿®æ”¹
- æ‰€æœ‰æ–°å¢APIç«¯ç‚¹å¿…é¡»æ›´æ–°ç¬¬6èŠ‚
- UIç»„ä»¶åº“å˜æ›´éœ€æ›´æ–°ç¬¬4.6èŠ‚
- æ•°æ®æ¨¡å‹ä¿®æ”¹éœ€æ›´æ–°ç¬¬5èŠ‚

**è”ç³»æ–¹å¼**:
- é¡¹ç›®ä»“åº“: `https://github.com/<your-org>/HL-os`
- é—®é¢˜åé¦ˆ: GitHub Issues
- æŠ€æœ¯æ”¯æŒ: <your-email>@example.com

---

*æœ¬æ–‡æ¡£æœ€åæ›´æ–°: 2026-01-20*
