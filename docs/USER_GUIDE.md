# 智学 OS 用户手册

**版本**: v1.2.0
**最后更新**: 2026-01-21

---

## 目录

- [1. 产品概述](#1-产品概述)
- [2. 功能模块](#2-功能模块)
- [3. UI设计系统](#3-ui设计系统)
- [4. 核心业务流程](#4-核心业务流程)
- [5. 使用技巧](#5-使用技巧)

---

## 1. 产品概述

### 1.1 定位

智学 OS 是一个**家庭多用户学习管理系统**，利用 Google Gemini 3 的多模态AI能力，将纸质学习材料（教材、手写笔记、考卷）数字化为结构化知识库。

### 1.2 核心价值

- 🎯 **智能图像识别**：4层OCR解构协议，精准提取题目、答案、批注
- 👨‍👩‍👧‍👦 **多用户隔离**：支持家庭多学生独立数据空间 + 共享资源
- 🧠 **AI驱动**：个性化课件生成、智能试卷出题、实时语音辅导
- 📚 **RAG增强**：AnythingLLM向量存储，上下文检索增强生成
- 📱 **全平台响应式**：桌面端、平板、手机统一体验

### 1.3 目标用户

- **主要用户**: 中小学生家庭（K12阶段）
- **次要用户**: 家长（监督学习进度）
- **使用场景**:
  - 错题拍照归档
  - 教材数字化管理
  - AI生成个性化学习内容
  - 考前针对性练习

---

## 2. 功能模块

### 2.1 Dashboard (概览面板)

**功能描述**:
- 个性化欢迎语（根据时段：早安/下午好/晚上好）
- ✅ **实时统计**: 基于扫描数据实时计算今日/本周收录、错题总数、掌握率
- ✅ **趋势可视化**: 最近7天学习趋势折线图
- 4个统计卡片：
  - **今日收录**: 当天扫描的错题/笔记数量
  - **本周收录**: 最近7天新增数量
  - **待复习**（错题）: 状态为WRONG的题目总数
  - **掌握率**: CORRECT/(CORRECT+WRONG)百分比，动态颜色
- 最近学习时间轴 (最近5条记录)
- 快捷入口网格 (4个常用功能)

**统计逻辑**:
```
todayCount    = timestamp >= 今天0点
weekCount     = timestamp >= 7天前
totalWrong    = meta.problems[].status === 'wrong'
masteryRate   = correct/(correct+wrong)*100
```

**交互行为**:
- 统计卡片显示动态趋势指示器
- 掌握率卡片根据分数动态变色:
  - ≥80%: 绿色 (已掌握)
  - ≥60%: 黄色 (需加强)
  - <60%: 红色 (未掌握)
- 趋势图支持鼠标悬停显示详细数据
- 快捷入口按钮 hover 时图标旋转6度 + 背景色过渡

---

### 2.2 LibraryHub (图书馆)

**功能描述**:
- 教材上传 (PDF/EPUB/TXT，最大100MB)
- 元数据AI自动提取 (标题、学科、年级、标签、目录)
- 图书卡片展示 (网格布局)
- 章节目录树结构展示
- 图书编辑/删除
- AnythingLLM索引集成 (可选)

**上传流程**:
```
1. 用户选择文件 → 支持拖拽/点击选择
2. 自动分片上传 → 文件 > 5MB 自动分片
3. 后端解析文件 → 提取前 4 页文本
4. AI智能提取元数据 → 识别书名、作者、学科、年级、出版社等
5. 用户确认元数据 → 可手动修正所有字段
6. 保存到服务器 → 按用户ID归档存储
```

**支持的元数据字段**:
- **书名**: 必填，AI 从封面/版权页提取
- **作者**: 选填
- **学科**: 下拉选择（语文/数学/英语/物理/化学/生物/历史/地理/政治/其他）
- **年级**: 下拉选择（一年级上~高三下）
- **类型**: 下拉选择（教科书/培训资料/工具书/课外读物）
- **出版社**: 选填
- **出版时间**: 选填（年-月格式）
- **标签**: 自定义，默认添加当前用户名

**关键特性**:
- **分片上传**: 支持大文件（最大100MB），实时进度显示
- **格式支持**: PDF、EPUB、TXT
- **AI智能提取**: Gemini AI 从前4页提取元数据，无需手动填写
- **降级处理**: AI 失败时使用文件名作为默认书名
- **用户归档**: 文件按用户ID独立存储，数据隔离

**图书卡片信息**:
- 封面图（未来版本将自动提取PDF首页）
- 标题和作者
- 学科和年级标签徽章
- 文件格式图标 (PDF/EPUB/TXT)
- 上传时间
- 快捷操作（编辑/删除/查看目录）

---

### 2.3 CaptureModule (拍题录入)

**功能描述**:
- 相机拍摄 (移动端)
- 图片上传 (桌面端)
- **✅ 多图片上传**: 一次选择多张图片，支持多页试卷
- **✅ 串行OCR处理**: 逐张处理，确保质量和稳定性
- **✅ 智能进度显示**: 实时显示当前处理进度（第X/共Y张）
- AI图像分析 (4层OCR解构)
- 结果审核与修正
- 批量归档

**多页试卷关联**:
```typescript
interface ScannedItem {
  parentExamId?: string;    // 父试卷ID（多页共享）
  pageNumber?: number;      // 当前页码（从1开始）
  totalPages?: number;      // 总页数
  multiPageSource?: boolean; // 是否来自多页试卷
}
```

**4层OCR解构协议**:
```markdown
第1层：印刷原题（原题文本）
第2层：红笔批改（教师批注）
第3层：学生行动（订正答案）
第4层：收尾闭环（是否真正掌握）
```

**交互流程**:
```
1. 用户上传图片 → 图片预览 + base64编码
2. 点击"分析"按钮 → 显示加载动画
3. AI分析完成 → 显示审核界面
   - Markdown预览
   - ProblemUnit列表编辑器
   - 每个题目可修改状态 (CORRECT/WRONG/CORRECTED)
4. 用户确认 → 触发庆祝动画 (confetti)
5. 自动归档 → 保存到服务器 + Obsidian + 向量库
```

**分片上传功能**:
- 自动分片：文件 > 5MB 自动分片上传
- 进度显示：实时显示分片索引和总字节数
- 智能重试：上传失败自动重试（1s, 2s, 3s）
- 自动合并：所有分片上传完成后自动合并
- 临时清理：24小时后自动清理过期分片文件

---

### 2.4 StudyRoom (AI学习园地)

**功能描述**:
三步走学习流程：
1. **选择章节**: 从图书馆选择教材和具体章节
2. **生成课件**: AI生成个性化Markdown课件 (4种教学风格)
3. **配套测验**: 基于课件内容生成测验题

**步骤1: ChapterSelector**:
- 展示用户图书馆的所有教材
- 树形目录结构选择器 (level 1/2/3 层级)
- 章节路径面包屑导航

**步骤2: CoursewareGenerator**:

**教学风格选项**:
| 风格 | 描述 |
|------|------|
| 📐 严谨讲解 | 系统完整，逻辑严密，适合理科 |
| 📚 故事化 | 生动形象，趣味性强，易于理解 |
| ✏️ 实践导向 | 大量例题，边学边练 |
| 🔍 探究式 | 启发思考，培养探索精神 |

**特性**:
- 智能提示：若检测到历史错题，优先讲解相关知识点
- 课件下载：Blob导出为 `.md` 文件
- 重新生成：清空当前课件重新选择风格

**步骤3: QuizGenerator**:

**出题规则**:
- 每个核心知识点：2道基础题 + 1道提高题
- 难度分配：70%基础题 + 30%提高题
- 若有历史错题：针对薄弱环节出变式题

**错误处理**:
- 404: API接口未找到 → 提示检查后端服务
- 429: API配额超限 → 提示升级套餐或稍后重试
- 503: 网络连接失败 → 提示检查防火墙
- 401/403: API认证失败 → 提示检查API Key

---

### 2.5 KnowledgeHub (档案库)

**功能描述**:
- 所有扫描项的集中展示
- 多维度过滤：
  - 文档类型 (错题/笔记/课件/考卷等)
  - 学科筛选
  - 时间排序
- 单项详情查看
- 编辑元数据
- 删除操作
- Markdown导出

**数据展示**:
- 卡片网格布局 (瀑布流效果)
- 缩略图 (base64图片预览)
- 题目数量徽章
- 学科标签
- 知识状态标签 (已掌握/未掌握/需加强)

**搜索与过滤**:
```typescript
const filtered = items
  .filter(item =>
    (selectedType === 'all' || item.meta.type === selectedType) &&
    (selectedSubject === 'all' || item.meta.subject === selectedSubject)
  )
  .sort((a, b) => sortOrder === 'desc'
    ? b.timestamp - a.timestamp
    : a.timestamp - b.timestamp
  );
```

---

### 2.6 ExamCenter (考试中心)

**功能描述**:
- 智能组卷 (基于错题本 + RAG检索)
- 难度选择 (简单/中等/困难)
- 题型分配 (选择题/填空题/解答题)
- 时间限制设定
- 模拟考试模式
- 答案提交与批改

**组卷逻辑**:
```
1. 用户选择学科、章节范围、难度级别
2. 系统从 wrongProblems[] 提取薄弱知识点
3. AnythingLLM RAG 检索相似题目
4. Gemini生成题目变式
5. 组装成完整试卷 (Markdown格式)
```

---

### 2.7 LiveTutor (AI实时辅导)

**功能描述**:
- 实时语音对话 (Gemini 2.5 Flash Live API)
- 屏幕共享模式 (实时分析题目)
- 文字+语音双模式
- 对话历史记录
- 知识点追踪

**技术实现**:
- WebSocket连接 (gemini-2.5-flash-preview-exp)
- Web Audio API (麦克风输入)
- MediaRecorder (音频录制)
- Canvas绘图 (实时波形显示)

---

## 3. UI设计系统

### 3.1 色彩系统

**主色调**:

| 颜色 | 色值 | 用途 |
|------|------|------|
| sky-500 | #4A90E2 | 主品牌色，按钮、链接 |
| mint-400 | #5FD4A0 | 成功状态，次级操作 |
| sunset-400 | #FFB84D | 警告提示，待办事项 |

**学科色彩**:
| 学科 | 主色 | 浅色背景 |
|------|------|----------|
| 数学 | #3B82F6 | #DBEAFE |
| 语文 | #FB7185 | #FECDD3 |
| 英语 | #A78BFA | #E9D5FF |
| 科学 | #10B981 | #D1FAE5 |

**背景色**:
- paper: `#F8F9FA` (纸张纹理背景)
- 渐变背景: `from-gray-50 to-paper`

### 3.2 字体系统

```css
font-family: "PingFang SC", "Microsoft YaHei", system-ui, -apple-system, sans-serif
```

**字号阶梯**:
- text-xs: 12px
- text-sm: 14px
- text-base: 16px
- text-lg: 18px
- text-xl: 20px
- text-2xl: 24px
- text-3xl: 30px

### 3.3 阴影系统

```css
shadow-card: 0 4px 16px rgba(0, 0, 0, 0.08)
shadow-card-hover: 0 8px 24px rgba(0, 0, 0, 0.12)
shadow-modal: 0 12px 32px rgba(0, 0, 0, 0.15)
```

### 3.4 间距系统

- 布局间距: `space-y-6` (24px)
- 卡片内边距: `p-6` (24px)
- 按钮内边距: `px-6 py-3`
- 网格间距: `gap-4` (16px)

### 3.5 响应式断点

| 断点 | 宽度 | 设备 |
|------|------|------|
| `sm` | 640px | 手机横屏 |
| `md` | 768px | 平板 |
| `lg` | 1024px | 桌面 |
| `xl` | 1280px | 大屏桌面 |

**布局策略**:
- **移动端** (<768px): 底部导航栏 + 单列布局
- **桌面端** (≥768px): 侧边栏导航 + 多列网格

### 3.6 组件库

**Button 组件**:
```typescript
variant: 'primary' | 'secondary' | 'outline' | 'success' | 'danger'
size: 'sm' | 'md' | 'lg'
icon?: LucideIcon
disabled?: boolean
loading?: boolean
```

**Card 组件**:
```typescript
hover?: boolean  // hover时阴影加深
className?: string
children: ReactNode
```

**Badge 组件**:
```typescript
variant: 'default' | 'success' | 'warning' | 'error' | 'info'
size: 'sm' | 'md'
children: string
```

**LoadingSpinner**:
- 3种尺寸 (sm/md/lg)
- 渐变色旋转动画

### 3.7 动画效果

**Framer Motion 动画**:
```typescript
// 页面切换
<motion.div
  initial={{ opacity: 0, y: 20 }}
  animate={{ opacity: 1, y: 0 }}
  exit={{ opacity: 0, y: -20 }}
  transition={{ duration: 0.3 }}
/>

// 卡片悬浮
<motion.div
  whileHover={{ scale: 1.02, boxShadow: '0 8px 24px rgba(0,0,0,0.12)' }}
  transition={{ type: 'spring', stiffness: 300 }}
/>

// 按钮点击
<motion.button
  whileTap={{ scale: 0.95 }}
/>
```

**Canvas Confetti (庆祝动画)**:
```typescript
import confetti from 'canvas-confetti';

// 题目分析完成时
confetti({
  particleCount: 100,
  spread: 70,
  origin: { y: 0.6 }
});
```

---

## 4. 核心业务流程

### 4.1 错题录入流程

```
┌─────────────────────────────────────────────────────────┐
│  1. 用户上传图片 (相机/相册)                              │
│     - 图片预览                                           │
│     - base64编码                                         │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│  2. 点击"分析"按钮                                        │
│     - 显示加载动画                                       │
│     - 调用AI分析接口                                      │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│  3. 后端AI处理                                            │
│     - Google Gemini 3 API                               │
│     - 4层OCR解构协议                                     │
│     - Schema强制JSON格式                                 │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│  4. 前端审核界面                                          │
│     - Markdown预览                                       │
│     - ProblemUnit列表编辑                                │
│     - 用户可修改status                                   │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│  5. 确认归档                                              │
│     - 保存到服务器                                        │
│     - Obsidian Markdown生成                              │
│     - 向量库索引                                          │
│     - 庆祝动画                                           │
└─────────────────────────────────────────────────────────┘
```

### 4.2 教材上传与索引流程

```
┌─────────────────────────────────────────────────────────┐
│  1. 用户选择文件                                          │
│     - 拖拽/点击选择                                      │
│     - 文件格式验证                                       │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│  2. 上传到后端                                            │
│     - 分片上传 (大文件)                                  │
│     - 进度显示                                           │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│  3. 文件解析                                              │
│     - 判断格式 (PDF/EPUB/TXT)                           │
│     - 提取文本内容 + 章节目录                            │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│  4. AI元数据提取                                          │
│     - Gemini分析内容片段                                 │
│     - 提取: 标题、学科、年级、标签、目录                 │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│  5. 前端元数据编辑                                        │
│     - 用户可修正AI提取的元数据                           │
│     - 编辑章节目录树                                     │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│  6. 文件已保存在服务器                                    │
│     - 原始PDF已保存                                      │
│     - 元数据已索引                                       │
│     - 自动触发AnythingLLM索引                           │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│  7. RAG索引（自动）                                        │
│     - 向量化存储用于上下文检索                           │
└─────────────────────────────────────────────────────────┘
```

### 4.3 个性化学习流程 (StudyRoom)

```
┌─────────────────────────────────────────────────────────┐
│  步骤1: 选择章节 (ChapterSelector)                        │
│  - 从图书馆选择教材                                       │
│  - 树形目录选择具体章节                                   │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│  步骤2: 生成课件 (CoursewareGenerator)                    │
│  - 选择教学风格 (严谨/故事化/实践/探究)                   │
│  - 智能提示: 若有历史错题，优先讲解                       │
│  - 显示Markdown课件                                      │
│  - 可下载/重新生成                                        │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│  步骤3: 配套测验 (QuizGenerator)                          │
│  - 基于课件内容 + 历史错题                                │
│  - 70%基础题 + 30%提高题                                 │
│  - Markdown渲染 + 下载                                   │
└─────────────────────────────────────────────────────────┘
```

### 4.4 智能组卷流程 (ExamCenter)

```
┌─────────────────────────────────────────────────────────┐
│  1. 用户选择参数                                          │
│     - 学科、章节范围                                      │
│     - 难度级别 (简单/中等/困难)                           │
│     - 题型分配 (选择/填空/解答)                           │
│     - 时间限制                                            │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│  2. 系统提取薄弱知识点                                     │
│     - 从 wrongProblems[] 分析                            │
│     - 统计高频错误类型                                    │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│  3. RAG上下文检索 (AnythingLLM)                          │
│     - 查询相似题目                                        │
│     - 提取教材相关章节                                    │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│  4. Gemini生成题目                                        │
│     - 针对薄弱点生成变式题                                │
│     - 按难度分配题目数量                                  │
│     - 生成标准答案和详细解析                              │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│  5. 组装试卷                                              │
│     - Markdown格式排版                                   │
│     - 包含答题卡、答案区、解析区                          │
│     - 可打印/导出                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 5. 使用技巧

### 5.1 多用户管理

**用户切换**:
- 点击顶部导航栏用户头像
- 选择目标用户（大宝/二宝/共享）
- 系统自动过滤显示该用户数据

**数据隔离**:
- 每个用户有独立的错题本和笔记
- "共享"资源对所有用户可见
- 图书馆可设置所有者（child_1/child_2/shared）

### 5.2 高效录入

**批量拍照技巧**:
- 使用手机多选功能一次选择多张试卷
- 系统自动按选择顺序排序页码
- 串行处理确保稳定性，避免API并发限制

**错题修正**:
- AI识别后可手动修改题目状态
- 支持编辑题目文本和学生答案
- 修正后自动更新统计数据

### 5.3 学习建议

**错题复习流程**:
1. Dashboard查看"待复习"数量
2. KnowledgeHub筛选"未掌握"错题
3. 重新练习相似题目（ExamCenter智能组卷）
4. 复习后修正状态为"已掌握"

**个性化学习路径**:
1. LibraryHub上传教材
2. StudyRoom选择章节学习
3. 系统推荐相关错题优先讲解
4. 配套测验检验学习效果
5. ExamCenter针对薄弱点组卷

### 5.4 快捷键

| 快捷键 | 功能 |
|--------|------|
| `Ctrl/Cmd + K` | 快速搜索 |
| `Ctrl/Cmd + N` | 新建录入 |
| `Ctrl/Cmd + /` | 切换用户 |
| `Esc` | 关闭弹窗 |

---

**相关文档**:
- [技术架构](./ARCHITECTURE.md) - 系统架构设计
- [部署指南](./DEPLOYMENT.md) - 部署步骤详解
- [安全配置](./SECURITY.md) - 安全加固指南
